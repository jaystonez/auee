(()=>{const e=window.shadowRootGlobal;window.isListening=!1,window.mediaRecorder=null,window.globalButton=null,window.audioChunks=[],window.silentMode=!1,window.mediaStream=null,window.isAudioPlaying=!1,window.terminateTriggered=!1,window.terminateTriggeredTime=null,window.isModalShowing=!1,window.requireInteraction=!0,window.globalAudio=new Audio,window.chatHistory=[],window.senderUser="User",window.senderAI="BrowserGPT",window.webSocketClient=null,window.extensionCheckInterval=null,window.isLoadingScreenActive=!1,window.currentVoiceButtonTooltip=null,window.licenseKey=null,window.instructionText=null,window.instructionId=null,window.previousInstructionId=null,window.converse_text=null,window.novaAgentMode=!1,window.isBrowserGPTIndex=!1,window.isBrowserGPTStickyElem=!1,window.bgptStickyButton=null,window.licenseAlertShown=!1,window.firstTaskInit=!1,window.novaUrl=null,window.chatInitialized=!1,window.iconWrapper=null,window.LicenseKeyNotSetInBackground=!0,window.generalPaymentLink="https://buy.stripe.com/fZe7toecN0AH6SQeV4",window.lifetimeSubscriptionLink="https://buy.stripe.com/28oaFA7Op97d3GEbIT",window.currentTask=null,window.overrideNovaAgentMode=!1,window.browserSocketStarted=!1,window.currentTaskKey="browserGptCurrentTask",window.bgptExecutorIsOnline=!1,window.initializationTriggered=!1,window.licenseTriggerCalled=!1,window.isMuted=!1,window.muteIcon=null,window.toggleRemoteListenerStatus=!1,window.pingExtension=!1,window.setContentScriptActive=null,window.setCurrentStateId=null,window.remoteTaskTriggered=!1,window.modalInputContainer=e?.querySelector("#modal-input-container"),window.modalInput=e?.querySelector("#modal-input"),window.currentUrl=null,window.extensionInstalled=!1,window.isSubmitting=!1,window.playAudioFailureAlert=!1,window.currentTabImage=null,window.voiceButtonState=null,window.chatHistoryLock=!1,window.chatHistoryQueue=[],window.isExecutorAgent=!1,window.ENABLE_REALTIME_MODE=!0,window.isStreaming=!1,window.isRealtimeMode=!1,window.ENABLE_RN_MESSAGE_PROXY=!0,window.extensionInstallUrl="https://chromewebstore.google.com/detail/browsergpt/hipciehccffmaaoghpleiffkcgbefjhf",window.typingTimer=null,window.inputTextClickHandler=null,window.inputTextMouseleaveHandler=null,window.inputTextInputHandler=null,window.submitInputClickHandler=null,window.handleMouseMove=null,window.recordingStartedHandler=null,window.recordingStoppedHandler=null,v(),window.onload=()=>{A()||ke("Realtime voice mode is coming soon...")},window.lastSpinnerToggle=0,window.lastCancelToggle=0,window.TOGGLE_DELAY=5e3,document.addEventListener("DOMContentLoaded",(function(){if(!e?.querySelector('script[src="/carousel-utils.js"]')){const e=document.createElement("script");e.src="/carousel-utils.js",e.async=!0,document.head.appendChild(e)}})),window.carouselItems=[];const t="browsergpt-sticky-onboarding-completed";let n=!1,o=[];const i=e=>{if(window.driver&&window.driver.js)e();else if(o.push(e),!n){n=!0;try{if("function"==typeof injectCSSFiles&&"function"==typeof injectScriptFiles){injectCSSFiles(document.body,["css/driver.css"]);const e=document.createElement("script");e.src=chrome.runtime.getURL("js/driver.js"),e.onload=()=>{n=!1,o.forEach((e=>{try{e()}catch(e){}})),o=[]},e.onerror=e=>{n=!1},document.body.appendChild(e)}else n=!1}catch(e){n=!1}}},s=()=>{const e=document.createElement("style");e.textContent="\n    .driver-popover {\n      background-color: #1A1E24 !important;\n      color: #ffffff !important;\n      border: 1px solid #04A492 !important;\n    }\n    \n    .driver-popover-title {\n      color: #04A492 !important;\n      font-weight: bold !important;\n    }\n    \n    .driver-popover-description {\n      color: #ffffff !important;\n    }\n    \n    .driver-popover-footer button {\n      background-color: #04A492 !important;\n      color: white !important;\n      border: none !important;\n      padding: 8px 15px !important;\n      border-radius: 5px !important;\n      cursor: pointer !important;\n      transition: background-color 0.3s !important;\n    }\n    \n    .driver-popover-footer button:hover {\n      background-color: #03877a !important;\n    }\n    \n    .driver-popover-navigation-btns {\n      display: flex !important;\n      gap: 10px !important;\n    }\n    \n    .driver-popover-close-btn {\n      color: #04A492 !important;\n    }\n    \n    .driver-popover-close-btn:hover {\n      color: #03877a !important;\n    }\n    \n    .driver-highlighted-element {\n      border: 2px solid #04A492 !important;\n    }\n  ",document.head.appendChild(e)},r=t=>{const n=document;try{const o=n.querySelector(t);if(o)return o;if(void 0!==e&&e){const n=e.querySelector(t);if(n)return n}return document.body}catch(e){return document.body}},a=(e,t)=>{if(!e)return null;try{const n=e.getBoundingClientRect();if(0===n.width||0===n.height)return null;const o=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth;if(n.top<0||n.left<0||n.bottom>o||n.right>i||n.top>o)return null;const s=`driver-mirror-${t}-${Date.now()}`,r=document.createElement("div");return r.id=s,r.style.position="fixed",r.style.top=`${n.top}px`,r.style.left=`${n.left}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,r.style.pointerEvents="none",r.style.zIndex="999999",r.className="driver-shadow-dom-wrapper",r.style.border="none",r.style.backgroundColor="transparent",r.style.outline="none",t&&r.setAttribute("data-element-label",t),document.body.appendChild(r),setTimeout((()=>{const t=e.getBoundingClientRect();r.style.top=`${t.top}px`,r.style.left=`${t.left}px`,r.style.width=`${t.width}px`,r.style.height=`${t.height}px`}),0),{element:`#${s}`,elementRef:r,originalElementRef:e,rect:n,cleanup:()=>{document.body.contains(r)&&document.body.removeChild(r)}}}catch(e){return null}},c=()=>{const t=r(".sticky-button-container"),n=r("#sticky-voice-button"),o=r("#sticky-chat-button"),i=r("#sticky-help-button"),s=r(".kebab-handle"),c=a(t,"sticky-button-container"),l=a(n,"sticky-voice-button"),d=a(o,"sticky-chat-button"),u=a(i,"sticky-help-button"),p=a(s,"kebab-handle"),m=[];c&&m.push(c),l&&m.push(l),d&&m.push(d),u&&m.push(u),p&&m.push(p);const w=(()=>{const t=e?.querySelector("#sticky-tour-center-element");if(t)return t;const n=document.createElement("div");return n.id="sticky-tour-center-element",n.style.position="fixed",n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%, -50%)",n.style.width="10px",n.style.height="10px",n.style.pointerEvents="none",n.style.zIndex="-1",document.body.appendChild(n),n})();return{steps:[{element:c?c.element:"body",popover:{title:"BrowserGPT Assistant",description:"This floating panel gives you quick access to BrowserGPT features on any website.",side:"top",align:"start"}},{element:l?l.element:"body",popover:{title:"Voice Input",description:"Tap once to speak and get a response.<br><br>Press and hold for 3 seconds to activate realtime voice mode.",side:"left",align:"end"}},{element:l?l.element:"body",popover:{title:"Standard vs. Realtime",description:"Standard mode: Best for quick questions and commands.<br><br>Realtime mode: Ideal for ongoing conversations and dictation.",side:"top",align:"start"}},{element:d?d.element:"body",popover:{title:"Chat Interface",description:"Click to open the chat panel where you can type messages and see responses.",side:"left",align:"end"}},{element:d?d.element:"body",popover:{title:"SmartSense Suggestions",description:"The SmartSense button appears when you hover over the chat button for 3 seconds.<br><br>It provides intelligent suggestions based on what you're doing on the current page.",side:"left",align:"end"}},{element:u?u.element:"body",popover:{title:"Help & Support",description:"Access help topics, FAQs, and contact support if you need assistance.",side:"left",align:"end"}},{element:c?c.element:"body",popover:{title:"Move the Panel",description:"Click and drag this handle to reposition the BrowserGPT panel anywhere on the page.",side:"top",align:"start"}},{element:w,popover:{title:"You're All Set!",description:"BrowserGPT is now ready to assist you on any website.<br><br> Try asking for help with browsing, writing, or completing tasks online!",side:"top",align:"center"}}],mirrorElements:m}},l=async()=>{await(async()=>{try{return!!await de(t)}catch(e){return!1}})()||i((()=>{s(),p()}))},d=(t,n="both")=>{if(t)if(void 0!==e&&e){const t=e.querySelectorAll(".sticky-button.top"),o=e.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||t.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"}))}else{const e=t.querySelectorAll(".sticky-button.top"),o=t.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||e.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"}))}},u=(t,n="both")=>{if(t)if(void 0!==e&&e){const t=e.querySelectorAll(".sticky-button.top"),o=e.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||t.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""}))}else{const e=t.querySelectorAll(".sticky-button.top"),o=t.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||e.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""}))}},p=()=>{if(window.driver&&window.driver.js)try{const e=document.createElement("style");e.textContent="\n\t\t\t.driver-shadow-dom-wrapper {\n\t\t\t\ttransition: none !important; /* Disable transitions to prevent positioning issues */\n\t\t\t\ttransform: translate3d(0, 0, 0); /* Force hardware acceleration */\n\t\t\t}\n\t\t\t\n\t\t\t.driver-popover {\n\t\t\t\tz-index: 9999999 !important;\n\t\t\t}\n\t\t\t\n\t\t\t.driver-overlay {\n\t\t\t\tz-index: 9999998 !important;\n\t\t\t}\n\t\t\t\n\t\t\t.driver-highlighted-element {\n\t\t\t\ttransition: none !important; /* Disable transitions for highlighted elements */\n\t\t\t\tborder: 2px solid #04A492 !important; /* Driver.js highlight border */\n\t\t\t}\n\t\t",document.head.appendChild(e);const{steps:t,mirrorElements:n}=c();r(".sticky-button-container")?setTimeout((()=>{m(t,n,e)}),300):m(t,n,e)}catch(e){try{const{mirrorElements:e}=c();e.forEach((e=>{e&&"function"==typeof e.cleanup&&e.cleanup()}))}catch(e){}}},m=(n,o,i)=>{const s=window.driver.js.driver({animate:!1,opacity:.2,padding:5,overlayClickNext:!1,doneBtnText:"Got it!",closeBtnText:"Skip",nextBtnText:"Next",prevBtnText:"Previous",smoothScroll:!1,stagePadding:0,showProgress:!0,allowClose:!0,stageRadius:2,overlayOpacity:.1,onHighlightStarted:(e,t,n)=>{const i=n.state.activeIndex,s=o[i];if(s&&s.elementRef&&s.originalElementRef){const e=s.originalElementRef.getBoundingClientRect();s.elementRef.style.top=`${e.top}px`,s.elementRef.style.left=`${e.left}px`,s.elementRef.style.width=`${e.width}px`,s.elementRef.style.height=`${e.height}px`,s.elementRef.offsetHeight}e&&"function"==typeof e.scrollIntoView&&e.scrollIntoView({behavior:"auto",block:"center"});const a=r(".sticky-button-container");switch(i){case 0:case 2:case 6:case 7:u(a,"both");break;case 1:u(a,"bottom");break;case 3:case 4:u(a,"top"),d(a,"bottom");break;case 5:u(a,"bottom"),d(a,"top")}y(4===i)},onDestroyStarted:async(n,c,l)=>{(()=>{const t=e?.querySelector("#sticky-tour-center-element");t&&t.parentNode.removeChild(t)})(),await(async()=>{try{await ce(t,"true")}catch(e){}})(),o.forEach((e=>{e&&"function"==typeof e.cleanup&&e.cleanup()})),i&&document.head.contains(i)&&document.head.removeChild(i),window.removeEventListener("resize",a);const d=r(".sticky-button-container");d&&u(d),y(!1),setTimeout((()=>{s.destroy()}),1e3)}});s.setSteps(n),s.drive();const a=()=>{o.forEach((e=>{if(e&&e.elementRef&&e.originalElementRef){const t=e.originalElementRef.getBoundingClientRect();e.elementRef.style.top=`${t.top}px`,e.elementRef.style.left=`${t.left}px`,e.elementRef.style.width=`${t.width}px`,e.elementRef.style.height=`${t.height}px`}}))};window.addEventListener("resize",a)},w=()=>{i((()=>{s(),p()}))},g=async()=>{try{await ce(t,null)}catch(e){}};"undefined"!=typeof window&&(window.BrowserGPTStickyOnboarding={startTour:w,resetOnboarding:g,initTour:l});const y=(t=!0)=>{if(void 0!==e&&e)try{const n=e.querySelector("#sticky-chat-button");if(!n)return;const o=n.querySelector(".chat-icon"),i=n.querySelector(".lightbulb-icon");if(!o||!i)return;t?(o.classList.add("hidden"),i.classList.remove("hidden")):(o.classList.remove("hidden"),i.classList.add("hidden"))}catch(e){}};let h=e?.querySelector(".modal-close-button");h&&b()&&h.addEventListener("click",(()=>Ve(!0)));let f=e?.querySelector(".ok-button");function b(){try{return!(void 0===e||!e||!e.BGPT_INJECTED)}catch(e){return!1}}function v(){try{let t=e?.querySelector("#browser_gpt_index");isBrowserGPTIndex=!!t}catch{isBrowserGPTIndex=!1}return isBrowserGPTIndex}function S(){try{let t=e?.querySelector("#browser_gpt_mini");return!!t}catch{return!1}}function k(e,t,n=!0){return new Promise(((o,i)=>{if(chatHistoryLock)return chatHistoryQueue.push({sender:e,message:t,persist:n,resolve:o,reject:i}),void o();chatHistoryLock=!0;(async()=>{try{const o=e===senderUser;if(v()&&G(t,o),!n)return;let i=await de("chatHistory");Array.isArray(i)||(i=[]),i.push({sender:e,message:t}),i.length>200&&(i=i.slice(-200)),ce("chatHistory",i),chatHistory=i}catch(e){throw e}finally{if(chatHistoryLock=!1,chatHistoryQueue.length>0){const e=chatHistoryQueue.shift();k(e.sender,e.message,e.persist).then(e.resolve).catch(e.reject)}}})().then(o).catch(i)}))}async function I(){try{const e=await de("chatHistory");if(!e||0===e.length)return" ";return e.map((e=>`${e.sender===senderUser?"User":"AI"}: ${e.message}`)).join("\n")}catch(e){return" "}}function T(t){return converse_text=t.prompt,new Promise(((t,n)=>{e?.querySelector("#input-text");He(converse_text,(()=>{t()}))}))}function E(e,t,n=0){let o=80;1==n&&(o=800),n<t.length?(e.textContent+=t.charAt(n),yt()&&requestAnimationFrame(ht),setTimeout((()=>E(e,t,n+1)),o)):e.textContent=t}function C(){if(extensionInstalled)return!0;const t=e?.querySelector("#mcjpbnabjihhnjikcmpljpglajjchlmj");let n=null!==t;try{return!(!b()&&!qe())||n}catch(e){return!1}}function _(){const e=window.navigator.userAgent;return e.includes("Chrome")||e.includes("Edg")&&!e.includes("OPR")}function L(){if(b()&&!v())return window.BrowserGPTStickyOnboarding.initTour(),!1;_()||A()?Le().then((e=>{e||z((e=>{e&&"undefined"!==e?(x(e),X(e,!0)):"undefined"===e?function(){H||(H=FingerprintJS.load());return H.then((e=>e.get())).then((e=>`${e.visitorId}@browsergpt.co`)).catch((e=>`${`guest_${(new Date).getTime()}_${Math.random().toString(36).substring(2,8)}`}@browsergpt.co`))}().then((e=>{X(e,!0).then((()=>{x(e)})).catch((e=>{x(null)}))})).catch((e=>{x(null)})):P(!0)}))})):function(){const t=e?.querySelector("#ok-button");_()||A()||qe()||(Xe("Your current browser is not supported, please switch to Chrome Browser and try again"),t.onclick=()=>{this.onclick=null,location.reload()})}(),(b()||v())&&de("chatHistory").then((e=>{e&&(chatHistory=e,v()&&e.forEach((e=>{G(e.message,e.sender===senderUser)})))}))}function x(t){t&&t.includes("@browsergpt.co");t&&"undefined"!==t?N():function(){const t="Hi, I'm BrowserGPT. How can I assist you today?",n=e?.querySelector("#ok-button");Q();Qe()&&Je();n&&(initializationTriggered||(initializationTriggered=!0,requireInteraction=!1,k(senderAI,t,!1).then((()=>{window.BrowserGPTMiniOnboarding.check()?window.BrowserGPTMiniOnboarding.forceStart(!0):window.BrowserGPTMiniOnboarding.init(!0)})).catch((e=>{}))))}()}function P(t=!1){if(!licenseTriggerCalled||t){if(licenseTriggerCalled=!0,licenseAlertShown&&!v())return!1;licenseAlertShown=!0,new Promise(((t,n)=>{new Promise(((t,n)=>{let o=requireInteraction;!1===requireInteraction&&(requireInteraction=!0);let i="Enter a valid BrowserGPT License Key to continue using the AI agent on your browser",s=`${i}  <br/><a href='${generalPaymentLink}' target='_blank' style='font-size: 12px;' class='hidden-link' hidden>Click here Instead!</a>`,r=e?.querySelector(".bubble");r&&(r.innerHTML=i),function(t,n){const o=()=>{webSocketClient.setCurrentAlertId(null)};return new Promise(((i,s)=>{!A()&&b()||!b()&&v()?(novaAgentMode?delayTime=4e4:delayTime=2e4,ot(t,!0).then((()=>{Ke(t,"input",n)})).catch((e=>{Ke(t,"input",n)}))):(delayTime=1e4,Ke(t,"input",n));const r=e?.querySelector("#close-modal");r&&r.classList.contains("hidden")&&r.classList.remove("hidden");const a=e?.querySelector("#ok-button"),c=e?.querySelector("#cancel-button");let l=null;const d=e=>{A||o(),clearTimeout(l),a.onclick=null,c&&(c.onclick=null),e?(Ve(!0),i(e)):(Ve(!0),c&&"buy now"!=c.textContent.toLowerCase()?s(e):setTimeout((()=>{s(e)}),1e3))};a.onclick=()=>d(!0),c&&(c.onclick=()=>{d(!1)}),requireInteraction||(fromMobile,l=setTimeout((()=>d(!0)),delayTime))}))}(s,"").then((i=>{requireInteraction=o;let s=e?.querySelector("#modal-input"),r=s.value;fetch("https://api.browser.civai.co/verify_licensekey",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({license_key:r})}).then((e=>e.json())).then((e=>{e.message?(converse_text=e.message,"success"===e.status?(X(r,!0),z((e=>{})),He(converse_text,(()=>{t(converse_text)}))):n("failed")):n("failed")})).catch((e=>{n()}))})).catch((e=>{n("showsubscription")}))})).then((e=>{t(!0)})).catch((e=>{n(e)}))})).then((e=>{if(!v())return!0;t?Xe("License key updated successfully, please refresh the page to continue"):N()})).catch((e=>{if("showsubscription"===e)window.showSubscription();else{let e=generalPaymentLink;K().then((t=>{e=V(t);requireInteraction;!1===requireInteraction&&(requireInteraction=!0),Xe("Your license key is invalid or expired, Click OK to Buy a new license key",(e=>{e&&window.showSubscription()}))}))}})).finally((()=>{licenseTriggerCalled=!1}))}}function q(t="Hold on, I need the BrowserGPT extension installed to continue. click the OK button to install."){const n=e?.querySelector("#ok-button");return new Promise(((e,o)=>{C()||A()?e(C()):(requireInteraction=!0,Xe(t),n.onclick=()=>{if(C()||null!=setCurrentStateId)e(!0);else{window.open(extensionInstallUrl,"_blank"),Qe()&&Je(),ze("Waiting for extension to be installed..."),setTimeout((()=>{Qe()&&Je(),ze("Detecting extension installation...")}),1e4);const t=5;let n=0;!async function(){for(;n<t;){n++,Y();try{return await le(5e3),e(!0)}catch(e){}}k(senderAI,"Extension installation check timed out, please make sure the BrowserGPT extension is installed and try again on a new tab",!1),Je(),e(!1)}()}n.onclick=null})}))}function A(){return!(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||qe())}function N(){webSocketClient=pt("wss://api.browser.civai.co");const t="Hi, I'm BrowserGPT. How can I assist you today?";k(senderAI,t,!1).then((()=>{})).catch((e=>{}));const n=e?.querySelector("#ok-button"),o=Q();if(Qe()&&Je(),n){if(o.mode&&"nova"===o.mode)return O(o.mode),requireInteraction=!1,void Xe("BrowserGPT will perform browser tasks on your behalf, do you accept?");if(!initializationTriggered){initializationTriggered=!0,requireInteraction=!1,ne([(e,n)=>{He(t,(()=>{e()}))},(e,t)=>{if(window.resumePendingPrompt&&window.resumePendingPrompt())e();else{window.BrowserGPTMiniOnboarding.check()?(window.BrowserGPTMiniOnboarding.forceStart(!0),e()):(window.BrowserGPTMiniOnboarding.init(!0),e())}}]).then((()=>{window.BrowserGPTMiniOnboarding.check()&&function(e){const t={type:"BGPT_INVOKE_EXTENSION",action:"updateCheck",bgptIndex:v(),currentStateId:setCurrentStateId};if(e&&"function"==typeof e){let t=!1;const n=setTimeout((()=>{t||(t=!0,e({status:!0,message:null,timestamp:(new Date).getTime(),timedOut:!0}))}),1e4);window.addEventListener("noNewUpdateResponse",(function(o){clearTimeout(n),t||(t=!0,e(o.detail))}),{once:!0})}window.postMessage(t,"*")}((e=>{new Promise(((e,t)=>{!b()&&A()?(st(),e()):e()}))}))})).catch((e=>{}))}}}function B(t,n="voice-button"){const o=e?.querySelector(`#${n}`);if(isStreaming||o&&o.classList.contains("listening")&&o.classList.remove("listening"),o)o.disabled=t,o.style.backgroundColor=t?"grey":"",o.style.pointerEvents=t?"none":"",o.style.opacity=t?"0.6":"";else if(!v()){const n=e?.querySelector("#sticky-voice-button");n&&(n.disabled=t,n.style.backgroundColor=t?"grey":"",n.style.pointerEvents=t?"none":"auto",n.style.opacity=t?"0.6":"1")}}function M(){if(v()){e?.querySelector("#input-text"),e?.querySelector("#voice-button"),e?.querySelector("#submit-input");window.recordingStartedHandler=function(){const t=e?.querySelector("#input-text"),n=e?.querySelector("#submit-input");t&&(t.style.transition="all 0.3s ease",t.style.opacity="0",t.style.visibility="hidden",t.style.pointerEvents="none"),n&&(n.style.transition="all 0.3s ease",n.style.opacity="0",n.style.visibility="hidden",n.style.pointerEvents="none")},window.recordingStoppedHandler=function(){const t=e?.querySelector("#input-text"),n=e?.querySelector("#submit-input");t&&(t.style.transition="all 0.3s ease",t.style.opacity="1",t.style.visibility="visible",t.style.pointerEvents="auto"),n&&(n.style.transition="all 0.3s ease",n.style.opacity="1",n.style.visibility="visible",n.style.pointerEvents="auto")},window.addEventListener("recording-started",window.recordingStartedHandler),window.addEventListener("recording-stopped",window.recordingStoppedHandler)}}function O(t){var n=e?.querySelector("#task-list-section"),o=e?.querySelector(".image-area"),i=e?.querySelector(".tab-section"),s=e?.querySelector("#input-text"),r=e?.querySelector(".submit-icon"),a=e?.querySelector("#voice-assistant-tab"),c=e?.querySelector("#nova-agent-tab");e?.querySelector("#heading");const l=e?.querySelector("#bubble");if("nova"===t){if(v()&&(window.recordingStartedHandler&&window.removeEventListener("recording-started",window.recordingStartedHandler),window.recordingStoppedHandler&&window.removeEventListener("recording-stopped",window.recordingStoppedHandler),window.recordingStartedHandler=null,window.recordingStoppedHandler=null),A())return void Xe("Nova agent mode is only accessible on chrome desktop");o.style.display="none",n.style.display="block",l.classList.add("nova"),i.classList.add("nova"),s.placeholder="Schedule a task...",c.classList.add("active");let e="Hi, I'm BrowserGPT. I'm now in Nova Agent mode!";renderTasks(),novaAgentMode=!0,He(e,(()=>{ct()})),a.classList.remove("active"),requireInteraction}else{const e=Q();if(e.mode&&"nova"===e.mode)return void O(e.mode);novaAgentMode=!1,novaAgentMode=!1,o.style.display="block",n.style.display="none",l.classList.remove("nova"),l.textContent="Hi, I'm BrowserGPT. How can I assist you today?",i.classList.remove("nova"),r.style.display="flex",a.classList.add("active"),c.classList.remove("active"),requireInteraction,M()}}function G(t,n){const o=e?.querySelector(".image-area");if(!o)return;if(t||(t=""),t.length<=1)return;chatInitialized||(o.innerHTML="",chatInitialized=!0);let i=e?.querySelector("#chat-container");i||(i=document.createElement("div"),i.id="chat-container",i.className="chat-container",o.appendChild(i));const s=n?String(t).replace(/\n/g,"<br>"):marked.parse(String(t)).replace(/\n/g,"<br>").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),r=document.createElement("div");r.className="chat-item "+(n?"user":"ai"),r.innerHTML=`\n        ${n?`\n            <div class="chat-message">${s}</div>\n            <div class="chat-icon">\n                <i class="fas fa-user-circle"></i>\n            </div>\n        `:`\n            <div class="chat-icon">\n                <i class="fas fa-robot"></i>\n            </div>\n            <div class="chat-message markdown-body">${s}</div>\n        `}\n    `,i.appendChild(r),function(e,t){const n=t.scrollHeight,o=.6*window.innerHeight;e.style.height=n<=o?`${n}px`:`${o}px`,t.style.overflowY="auto"}(o,i),i.scrollTop=i.scrollHeight}function R(t){const n=e?.querySelector("#voice-button")||e?.querySelector("#sticky-voice-button");if(n&&!function(e,t){if(!e||!t)return voiceButtonState=t,!1;const n=JSON.stringify(e)===JSON.stringify(t);return n||(voiceButtonState=t),n}(voiceButtonState,t))switch(t.state){case"muted":Ie("realtime-mute-toggle",!0);break;case"unmuted":Ie("realtime-mute-toggle",!1);break;case"listening":startRealtimeMode(!1);break;case"idle":n.classList.remove("listening"),n.innerHTML='<i class="fas fa-microphone icon-size"></i>',Ie("realtime-shutdown")}}f&&f.addEventListener("click",(()=>Ve(!0))),window.isSticky=b,window.isBrowserGPTIndexfunc=v,window.addMessageToChatHistory=k,window.addEventListener("message",(function(e){if(e.source===window&&e.data.type&&"BGPT_FROM_EXTENSION"===e.data.type){if(["completed_task","failed_task","failed_execution","info_message","initiation_request","input_request"].includes(e.data.content.status)){let t=e.data.content.status;"initiation_request"===t&&(e.data.content.message=e.data.content.message.replace(", should i proceed?","")),"info_message"===t&&e.data.content.message.includes("---")&&isStreaming&&(e.data.content.message=e.data.content.message.replace("---","NOTE: DO NOT EXECUTE BROWSER ACTION ACTION FROM THIS QUESTION, JUST NOTIFY THE USER THAT THERE IS A NEW QUESTION FOR THEM TO ANSWER")),Se(t,e.data.content.message,instructionId)}}})),window.addEventListener("message",(function(t){if(t.source===window&&t.data.type&&"BGPT_FROM_EXTENSION"===t.data.type)if("invalid_key"!==t.data.content.status){let n=t.data.content.status;if(t.data.content.bgptIndex!==v()&&t.data?.content?.action&&!t.data.content.action.includes("setStateId"))return;if(b()&&v())return;if("setStateId"==t.data.content.action)return void(setCurrentStateId&&b()||(setCurrentStateId=t.data.content.stateId,window.setCurrentStateId=setCurrentStateId));if(t.data.content.stateId!==setCurrentStateId&&null!==setCurrentStateId)return void(terminateTriggered||ge());if("duplicate_request_found"==t.data.content.action);else if("customPromptResponse"==t.data.content.action&&b())be(t.data.content.message);else if("enable_cancel_mode"==t.data.content.action){const e=t.data.content.message.force,n=Date.now();if(n-window.lastCancelToggle<window.TOGGLE_DELAY&&!e)return;window.lastCancelToggle=n,he(!1),F(!0),rt("cancel_mode",!0)}else if("disable_cancel_mode"==t.data.content.action){const e=t.data.content.message.force,n=Date.now();if(n-window.lastCancelToggle<window.TOGGLE_DELAY&&!e)return;window.lastCancelToggle=n,F(!1),rt("cancel_mode",!1)}else if("enable_spinner_mode"==t.data.content.action){const e=t.data.content.message.force,n=Date.now();if(n-window.lastSpinnerToggle<window.TOGGLE_DELAY&&!e)return;window.lastSpinnerToggle=n,window.lastCancelToggle=n,F(!1),he(!0),rt("spinner_mode",!0)}else if("disable_spinner_mode"==t.data.content.action){const e=t.data.content.message.force,n=Date.now();if(n-window.lastSpinnerToggle<window.TOGGLE_DELAY&&!e)return;window.lastSpinnerToggle=n,he(!1),rt("spinner_mode",!1)}else if("initiation_request"===n)ne([(e,n)=>{t.data.content.playSpeech||silentMode?(He(t.data.content.message,e),e()):e()},(e,n)=>{k(senderAI,t.data.content.message),e()},(e,n)=>{isRealtimeMode&&isStreaming?(z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"userConfirmation",userResponse:"yes",apikey:e,currentStateId:setCurrentStateId},"*")})),e()):(requireInteraction=!0,Ye(t.data.content.message).then((t=>{t&&(k(senderUser,"Yes!"),z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"stopAudio",apikey:e,currentStateId:setCurrentStateId},"*"),window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"userConfirmation",userResponse:"yes",apikey:e,currentStateId:setCurrentStateId},"*")}))),e()})).catch((e=>{k(senderUser,"No!"),z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"stopAudio",currentStateId:setCurrentStateId},"*"),window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"userConfirmation",userResponse:"no",apikey:e,currentStateId:setCurrentStateId},"*")})),F(!1),n(e)})))}]).then((()=>{oe()})).catch((e=>{oe()}));else if("input_request"===n)converse_text=t.data.content.message,ne([(t,n)=>{requireInteraction=!0,function(t,n){const o=()=>{webSocketClient.setCurrentAlertId(null)};return new Promise(((i,s)=>{A()?(delayTime=1e4,Ke(t,"question",n)):(novaAgentMode?delayTime=4e4:delayTime=2e4,ot(t,!0).then((()=>{Ke(t,"question",n)})).catch((e=>{Ke(t,"question",n)})));const r=e?.querySelector("#ok-button"),a=e?.querySelector("#cancel-button");a&&a.classList.remove("hidden");let c=null;const l=e=>{A||o(),requireInteraction||clearTimeout(c),r.onclick=null,a&&(a.onclick=null),Ve(!0),i(e)},d=()=>{A||o(),requireInteraction||clearTimeout(c),r.onclick=null,a&&(a.onclick=null),Ve(!0),s("cancelled")};let u=e?.querySelector("#modal-input");r.onclick=()=>l(u.value),a&&(a.onclick=()=>d()),requireInteraction||(c=(fromMobile,setTimeout((()=>l("")),delayTime)))}))}(converse_text,"Type your response here...").then((e=>{z((t=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"questionResponse",response:e,apikey:t,currentStateId:setCurrentStateId},"*")})),t(e)})).catch((e=>{n(e)}))},(e,t)=>{k(senderAI,converse_text),se().then((e=>{null===e&&(F(!0),B(!1),B(!1,"submit-input"))})),e()}]).then((()=>{oe()})).catch((e=>{oe()}));else if("completed_task"===n||"failed_task"===n){converse_text=t.data.content.message;const e=()=>{se().then((e=>{it(e).then((()=>{lt()})).catch((e=>{lt()}))})),ie(null,!0)};ne([(e,n)=>{t.data.content.playSpeech||silentMode?He(converse_text,(()=>{e()})):e()},(e,t)=>{if(k(senderAI,converse_text),F(!1),B(!1),he(!1),B(!1,"submit-input"),"failed_task"===n){let t=null;je(`${converse_text}\n\n`,"Yes, proceed!","No, cancel").then((n=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"stopAudio",apikey,currentStateId:setCurrentStateId},"*"),t=n,"Yes, proceed!"===n&&fe(`${senderAI}: ${converse_text}\n\n${senderUser}: ${n}`),k(senderUser,n),e()})).catch((n=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"stopAudio",currentStateId:setCurrentStateId},"*"),k(senderUser,t),e()}))}else e()},(t,n)=>{ot(converse_text,!1,!0),e(),t()}]).then((()=>{oe()})).catch((e=>{oe()}))}else"failed_execution"===n?(converse_text=t.data.content.message,ne([(e,n)=>{t.data.content.playSpeech||silentMode?He(converse_text,(()=>{e()})):e()},(e,t)=>{k(senderAI,converse_text),e()},(e,t)=>{ot(converse_text,!1,!0),e()}]).then((()=>{oe()})).catch((e=>{oe()}))):"info_message"===n?(converse_text=t.data.content.message,ne([(e,n)=>{t.data.content.playSpeech||silentMode?He(converse_text,(()=>{e()})):e(),k(senderAI,converse_text)},(e,t)=>{ot(converse_text,!1,!0),e()}]).then((()=>{oe()})).catch((e=>{oe()}))):"broadcast"===n?"license_key"===t.data.content.message.key?t.data.content.message.value&&"null"!==t.data.content.message.value&&(X(t.data.content.message.value),rt("current_url",window.location.href)):"captureScreen"===t.data.content.message.key&&(rt("captureScreen",t.data.content.message.value),currentTabImage=t.data.content.message.value,ve(`${currentTabImage}`,"system")):"override_nova_agent_mode"===n?(b()||novaAgentMode||v())&&(overrideNovaAgentMode=!0,ct()):"dont_override_nova_agent_mode"===n&&(se().then((t=>{if(!isStreaming&&!isListening&&null===t){let t=e?.querySelector("#sticky-voice-button");t&&(t.classList.remove("listening"),t.innerHTML='<i class="fas fa-microphone icon-size"></i>')}})),(b()||novaAgentMode)&&(overrideNovaAgentMode=!1,D(!1),remoteTaskTriggered||dt()))}else"invalid_key"===t.data.content.status&&P()})),window.licenseTrigger=P,window.extensionCheck=q,window.isMobileDevice=A,window.showSuggestions=function(){k(senderAI,'\n### Here are some examples of what you can ask me to do:\n\n- 🔍 **"Switch to my Gmail tab"**\n- ⏰ **"Remind me to call mom tomorrow at 3pm"**\n- 🎵 **"Play Drake on Spotify web player"**\n- ✍️ **"Fix the typo in my Facebook post draft and send it"**\n- 🔒 **"Stop asking for permissions when completing tasks"**\n- ❌ **"Cancel the ongoing task"**\n- 🧠 **"Enable/Disable smart sense"**\n\n*Feel free to try any of these commands or ask me to help with something else!*',!1)},window.toggleButtonState=B;let H=null;function $(t,n=null){Ee("voice_prompt").then((o=>{o.available?function(){if(n=e?.querySelector("#sticky-voice-button"),!v()&&b()){if(n){if(n.classList.contains("cancel-mode"))return n.classList.remove("cancel-mode"),F(!1),void W();globalButton=n}bgptStickyButton=t,licenseAlertShown=!1,z((e=>{if(e)U(t);else{P()&&U(t)}}))}else{if(globalButton=t,t.classList.contains("cancel-mode"))return F(!1),he(!1),void W();U(t)}}():Xe(o.message||"Voice prompt service is currently unavailable")}))}function U(e){isListening=!isListening,isListening?(e.classList.add("listening"),navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>function(e,t){(function(){if(b()||v()&&!A()){const e={type:"BGPT_INVOKE_EXTENSION",action:"stopAudio",currentStateId:setCurrentStateId,bgptIndex:v()};window.postMessage(e,"*")}globalAudio&&!globalAudio.paused&&(globalAudio.pause(),globalAudio.currentTime=0,isAudioPlaying=!1,B(!1))})(),window.dispatchEvent(new CustomEvent("recording-started")),mediaStream=e;let n=null;n=_()&&A()&&!b()?{mimeType:"audio/mp3"}:{mimeType:"audio/webm"};MediaRecorder.isTypeSupported(n.mimeType)||(n={});const o=new AudioContext,i=o.createMediaStreamSource(e),s=o.createAnalyser();s.fftSize=2048,i.connect(s);let r=null;const a=-40,c=3e3;function l(){const e=new Float32Array(s.fftSize);s.getFloatTimeDomainData(e);let n=0;for(let t=0;t<e.length;t++)n+=e[t]*e[t];const o=Math.sqrt(n/e.length);if(20*Math.log10(o)<a)if(r){if(Date.now()-r>c)return void $(t)}else r=Date.now();else r=null;"recording"===mediaRecorder.state&&requestAnimationFrame(l)}mediaRecorder=new MediaRecorder(e,n),mediaRecorder.ondataavailable=e=>{audioChunks.push(e.data)},mediaRecorder.onstop=()=>{o.close(),t.classList.contains("cancel-mode")||function(e){const t=["audio/mp3","audio/mp4","video/mp4","video/mpeg","audio/mpeg","audio/mpga","audio/m4a","audio/wav","audio/webm","audio/webm;codecs=opus"];let n=audioChunks[0]?.type||"audio/webm";if(!t.includes(n))return He("Sorry, I can't process the audio file of type "+n),e.disabled=!1,void(e.style.backgroundColor="");{const t=new Blob(audioChunks,{type:n});if(t.size>26214400)return;I().then((o=>{A()?Me(e,o,t,n):(b()||v())&&C()?function(e,t,n,o){he(!0);const i=new FileReader;i.onloadend=function(){const n=i.result;currentUrl=window.location.href,z((i=>{const s={type:"BGPT_INVOKE_EXTENSION",action:"sendAudio",audio:n,mimeType:o,conv_history:t,button_id:e.id,apikey:i,currentUrl,bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(s,"*")}))},i.readAsDataURL(n)}(e,o,t,n):Me(e,o,t,n)})).catch((t=>{e.disabled=!1,e.style.backgroundColor=""}))}setTimeout((()=>{e.disabled=!1,e.style.backgroundColor=""}),1e4),audioChunks=[]}(t)},mediaRecorder.start(1e3),l()}(t,e))).catch((t=>{"NotAllowedError"===t.name?Xe("Microphone access was denied. Please check your browser settings."):"NotFoundError"===t.name?Xe("No microphone was found. Please connect a microphone and try again."):Xe("An error occurred while trying to access the microphone: "+t.message),e.disabled=!1,e.style.backgroundColor="",e.classList.remove("listening")}))):(e.classList.remove("listening"),function(e){mediaRecorder&&"recording"===mediaRecorder.state&&mediaRecorder.stop();mediaStream&&mediaStream.getTracks().forEach((e=>e.stop()));e.disabled=!0,e.style.backgroundColor="grey",window.dispatchEvent(new CustomEvent("recording-stopped"))}(e))}function D(t){if(!toggleRemoteListenerStatus||!t)if(toggleRemoteListenerStatus=t,!v()&&b())globalButton=e?.querySelector("#sticky-voice-button"),function(e,t){isStreaming||e&&e.classList.contains("listening")&&e.classList.remove("listening"),t?e.classList.add("pulsate"):e.classList.remove("pulsate")}(globalButton,t);else{button=e?.querySelector("#voice-button");const n=button.querySelector("i");isRealtimeMode?t?button.classList.add("pulsate"):(button.style.backgroundColor="",button.classList.remove("pulsate"),n&&(n.classList.remove("fa-satellite-dish"),n.classList.add("fa-microphone"))):t?n&&n.classList.add("pulsate"):n&&n.classList.remove("pulsate")}}function F(t,n=!1){if(b())globalButton=e?.querySelector("#sticky-voice-button"),function(e,t){const n=e.querySelector(".icon-size");isStreaming||e&&e.classList.contains("listening")&&e.classList.remove("listening"),t?(e.style.backgroundColor="grey",e.style.color="white",e.style.border="none",n&&(n.classList.remove("fa-microphone"),n.classList.add("fa-times")),e.classList.add("cancel-mode"),e.classList.add("inactive")):(e.disabled=!1,e.style.backgroundColor="",e.style.color="",e.style.border="",n&&(n.classList.remove("fa-times"),n.classList.add("fa-microphone")),e.classList.remove("cancel-mode"),e.classList.remove("inactive"))}(globalButton,t);else{const o=e?.querySelector("#voice-button"),i=e?.querySelector("#submit-input"),s=o?.querySelector("i");i?.querySelector("i");if(isStreaming||o&&o.classList.contains("listening")&&o.classList.remove("listening"),isRealtimeMode)t?o&&(o.dataset.originalBgColor||(o.dataset.originalBgColor=o.style.backgroundColor),s&&!s.dataset.originalClasses&&(s.dataset.originalClasses=Array.from(s.classList).join(" ")),o.style.backgroundColor="#6c757d",o.classList.add("spinner-mode","realtime"),s&&(s.classList.remove("fa-microphone","fa-satellite-dish","fa-times"),s.classList.add("fa-circle-notch"))):o&&(o.style.backgroundColor=o.dataset.originalBgColor||"",delete o.dataset.originalBgColor,o.classList.remove("spinner-mode","realtime"),s&&(s.dataset.originalClasses?(s.className=s.dataset.originalClasses,delete s.dataset.originalClasses):(s.classList.remove("fa-circle-notch"),o.classList.contains("cancel-pulse")||o.classList.contains("pulsate")||s.classList.add("fa-microphone"))));else if(t){if(o){const e=o.querySelector("i");n||(o.style.backgroundColor="grey",o.style.color="white",o.style.border="none",o.classList.add("cancel-mode")),e&&(e.classList.remove("fa-microphone"),e.classList.add("fa-times"))}}else if(o){const e=o.querySelector("i");o.style.backgroundColor="",o.style.color="",o.style.border="",o.classList.remove("cancel-mode"),e&&(e.classList.remove("fa-times"),e.classList.add("fa-microphone"))}}}function K(){return fetch("https://ipapi.co/json/").then((e=>{if(e.ok)return e.json();throw new Error("Failed to fetch country information")})).then((e=>e.country_name)).catch((e=>null))}function V(e){return"Nigeria"===e?"https://flutterwave.com/pay/5k9riwjohofu":"https://buy.stripe.com/fZe7toecN0AH6SQeV4"}function j(){const e=navigator.userAgent||navigator.vendor||window.opera;return!(!/iPhone|iPad|iPod/i.test(e)||!/Safari/i.test(e)||/CriOS/i.test(e))}function X(e,t=!0){return new Promise(((n,o)=>{try{b()?n("Not setting in sticky mode"):(localStorage.setItem("browserGptLicenseKey",e),t?function(e){return new Promise(((t,n)=>{if(e&&"null"!==e){const n={type:"BGPT_INVOKE_EXTENSION",action:"savelicenseKey",licenseKey:e,bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(n,"*"),t(!0)}else t(!1)}))}(e).then((()=>{n("License key stored successfully!"),LicenseKeyNotSetInBackground=!1})).catch((e=>{o("Failed to store license key: "+e),LicenseKeyNotSetInBackground=!0})):(n("License key set but not stored permanently."),LicenseKeyNotSetInBackground=!0))}catch(e){o("Error setting the license key: "+e)}}))}function Y(){return new Promise(((e,t)=>{const n={type:"BGPT_INVOKE_EXTENSION",action:"getFreshStateId",bgptIndex:v()};window.postMessage(n,"*"),e(!0)}))}function W(){return new Promise(((e,t)=>{const n={type:"BGPT_INVOKE_EXTENSION",action:"reloadExtension",bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(n,"*"),e(!0)}))}function z(e){let t=localStorage.getItem("browserGptLicenseKey"),n=localStorage.getItem("bgptLastVerificationTime");if(null==t||b())!function(e){const t={type:"BGPT_INVOKE_EXTENSION",action:"getLicenseKey",bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(t,"*");const n=setTimeout((()=>{e&&e(!1)}),5e3);window.addEventListener("getLicenseKeyResponse",(function(t){clearTimeout(n);let o=t.detail;o?(X(o,!1),e&&e(o)):e&&e(!1)}),{once:!0})}((t=>{if(t){if(!e)return t;e(t)}else{if(!e)return"undefined";e("undefined")}}));else{const o=(new Date).getTime();if(null!=n&&o-n>144e5)J(t,(n=>{if(n){if(1==LicenseKeyNotSetInBackground&&X(t,!0),!e)return t;e(t)}else{if(!e)return null;e(!1)}}));else{if(null==n&&localStorage.setItem("bgptLastVerificationTime",(new Date).getTime()),1==LicenseKeyNotSetInBackground&&X(t),!e)return t;e(t)}}}function J(e,t){if(e&&"null"!==e)fetch("https://api.browser.civai.co/verify_licensekey",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({license_key:e})}).then((e=>e.json())).then((e=>{if("success"===e.status){if(localStorage.setItem("bgptLastVerificationTime",(new Date).getTime()),!t)return!0;t(!0)}else{if(!t)return!1;t(!1)}})).catch((e=>{if(!t)return!1;t(!1)}));else{if(!t)return!1;t(!1)}}function Q(){const e={};return window.location.search.substring(1).split("&").forEach((t=>{const[n,o]=t.split("=");e[n]=decodeURIComponent(o)})),e}function Z(e,t){window.dispatchEvent(new CustomEvent("noNewUpdateResponse",{detail:{status:e,message:t,timestamp:(new Date).getTime()}}))}function ee(e,t=null,n=null){if("converse"===e.action)te(e,t,n);else{if(e.prompt){let t=["switch_to_tab","schedule_task","cancel_ongoing_process","update_ask_permissions","toggle_smart_sense"];e.summary&&e.summary.length>3||t.includes(e.action)?message=`\n\t\t\t\t${e.summary}\n\t\t\t\t<br>\n\t\t\t\t<br>\n\t\t\t\tI need the BrowserGPT extension installed before I can continue, please click OK to install.\n\t\t\t\t`:message=`\n\t\t\t\tI am about to perform the following action:\n\t\t\t\t<br>\n\t\t\t\t<i>'${e.prompt}'</i>\n\t\t\t\t<br>\n\t\t\t\t<br>\n\t\t\t\tI need the BrowserGPT extension installed before I can continue, please click OK to install.\n\t\t\t\t`}else message="I need the BrowserGPT extension to perform this action, please click OK to install.";if(!C()&&!b()&&e.prompt){const t={promptData:e,expiryTime:Date.now()+6e5};localStorage.setItem("pendingBrowserGPTPrompt",JSON.stringify(t))}q(message).then((o=>{o?te(e,t,n):Xe("Extension not detected, please make sure the extension is installed and try again.",(()=>{window.open(extensionInstallUrl,"_blank"),b()||(ze("Page is being reloaded, please wait..."),setTimeout((()=>{window.location.reload()}),5e3))}))}))}}function te(e,t=null,n=null){if(e.instructionId||(e.instructionId=Date.now()),instructionId=e.instructionId,(b()||!A())&&["summarize_tasks_for_the_day","see_what_is_on_the_page","take_screenshot","analyze_page_content"].includes(e.action))return void("summarize_tasks_for_the_day"===e.action?fe(e.prompt,!0):Te().then((e=>{const{image:t,description:n,currentUrl:o}=e;n?ve(`\n\t\t\t\t\t\t\tSYSTEM Notification: \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tUser is currently on the webpage ${o} \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tHere is the Visual Description of the webpage: \n\t\t\t\t\t\t\t${n}.`,"system"):fe(e.prompt,!0)})).catch((e=>{})));["perform_task","perform_browser_action","open_url","summarize_page_content"].includes(e.action)&&(e.action="navigate"),ie(e.prompt);if(["navigate","task_list","switch_to_tab","schedule_task","cancel_ongoing_process","update_ask_permissions","toggle_smart_sense"].includes(e.action)&&!b()&&A()&&!C())tt(e,t,n);else if("navigate"!==e.action&&"task_list"!==e.action||e.instructionId===previousInstructionId)if("schedule_task"===e.action&&e.instructionId!==previousInstructionId)previousInstructionId=e.instructionId,e.prompt=e.message,ne([(t,n)=>{k(senderAI,e.message),t()},(t,n)=>{T(e),ie(null),t()}]).then((()=>{})).catch((e=>{})).finally((()=>{B(!1),B(!1,"submit-input"),F(!1),he(!1)}));else if("converse"===e.action&&e.instructionId!==previousInstructionId)previousInstructionId=e.instructionId,ne([(t,n)=>{k(senderAI,e.prompt),t()},(t,n)=>{T(e),ie(null),t()},(t,n)=>{ot(e.prompt,!1,!0),t()},(t,n)=>{Se("info_message",e.prompt,instructionId),t()}]).then((()=>{B(!1),F(!1),he(!1)})).catch((e=>{B(!1),F(!1),he(!1)}));else if("toggle_smart_sense"===e.action&&e.instructionId!==previousInstructionId)previousInstructionId=e.instructionId,B(!1),F(!1),he(!1),ie(null),o=e.prompt,i=()=>{const t="true"===e.prompt?"You have enabled smart sense. BrowserGPT will now use smart sense to perform tasks on your behalf.":"You have disabled smart sense. BrowserGPT will no longer use smart sense to perform tasks on your behalf.";k(senderAI,t),Xe(t),Se("info_message",t,instructionId)},z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"toggleSmartSense",status:!!o.includes("true"),apikey:e,bgptIndex:v(),currentStateId:setCurrentStateId})})),i&&i();else if("update_ask_permissions"===e.action&&e.instructionId!==previousInstructionId){previousInstructionId=e.instructionId,DoNotAskPermissionToPerformTasksAgain=!1;const t=e.prompt&&e.prompt.includes("false")?"You have granted BrowserGPT the ability to perform tasks on your behalf without your consent. You can revoke this anytime.":"You have revoked BrowserGPT the ability to perform tasks on your behalf without your consent. You can grant this anytime.";k(senderAI,t),Xe(t),ie(null),B(!1),B(!1,"submit-input"),F(!1),he(!1),z((t=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"askPermissionToPerformAction",status:e.prompt&&e.prompt.includes("true"),apikey:t,bgptIndex:v(),currentStateId:setCurrentStateId},"*")})),Se("info_message",t,instructionId)}else if("cancel_ongoing_process"===e.action&&e.instructionId!==previousInstructionId){if(previousInstructionId=e.instructionId,DoNotAskPermissionToPerformTasksAgain=!1,"true"===e.prompt){const e="I have cancelled the ongoing process.";k(senderAI,e),Xe(e),Se("info_message",e,instructionId)}F(!1),B(!1),B(!1,"submit-input"),he(!1),ie(null),z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"reloadExtension",apikey:e,bgptIndex:v(),currentStateId:setCurrentStateId},"*")}))}else"switch_to_tab"===e.action&&e.instructionId!==previousInstructionId?(previousInstructionId=e.instructionId,converse_text=e.prompt,he(!1),B(!1),F(!1),ie(null),n&&t&&(n.textContent=converse_text,t.placeholder="Type your question here..."),z((t=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"switchToTab",prompt:e.prompt,url:e.url,apikey:t,bgptIndex:v(),novaUrl,currentStateId:setCurrentStateId,enable_realtime_mode:!!isStreaming},"*")})),Se("info_message","Switching to tab...",instructionId)):"log_me_out"===e.action&&e.instructionId!==previousInstructionId&&(previousInstructionId=e.instructionId,B(!1),B(!1,"submit-input"),F(!1),he(!1),ie(null),z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"logMeOut",apikey:e,bgptIndex:v(),currentStateId:setCurrentStateId},"*")})),X("",!0),Se("info_message","User has been logged out of BrowserGPT, please wait for the page to reload...",instructionId),Xe("You have been logged out of BrowserGPT",(()=>{setTimeout((()=>{window.location.reload()}),isStreaming?4e3:1e3)})));else{if(void 0===e.prompt||null===e.prompt||""===e.prompt||e.prompt.length<5)return void Se("info_message","Prompt is undefined, skipping action",instructionId);previousInstructionId=e.instructionId;let o=e.reasoning;currentTask=e.query,ie(e.query),F(!0),o&&k(senderAI,o),converse_text=e.prompt,n&&t&&(n.textContent=converse_text,t.placeholder="Type your question here..."),k(senderAI,e.message),C()||e.enable_realtime_mode||b()?(he(!0),firstTaskInit=!0,Ge(e.url)===Ge(window.location.href)?z((t=>{function n(){window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"task_list"===e.action?"captureTab":"novaCurrentTab",prompt:e.prompt,data:"task_list"===e.action?e:null,apikey:t,bgptIndex:v(),novaUrl,currentStateId:setCurrentStateId,instructionId,enforceUserConfirmation:!1,enable_realtime_mode:e.enable_realtime_mode||!1,directExecution:e.directExecution||!1,stepsLimit:20,maxAttempts:3},"*")}t.endsWith("browsergpt.co")?(requireInteraction=!0,je("⚡ Free tier users may experience delays and errors. Please remember to upgrade to access our most capable and intelligent AI agent for faster, error-free performance","Continue","Upgrade",!1).then((e=>{"Upgrade"===e?(Pt(),he(!1),B(!1),F(!1)):n()}))):n()})):z((t=>{function n(){window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"task_list"===e.action?"captureTab":"novaOpenWeb",prompt:e.prompt,url:e.url,data:"task_list"===e.action?e:null,apikey:t,bgptIndex:v(),novaUrl,currentStateId:setCurrentStateId,instructionId,enforceUserConfirmation:!1,enable_realtime_mode:e.enable_realtime_mode||!1,directExecution:e.directExecution||!1,stepsLimit:10,maxAttempts:3},"*")}t.endsWith("browsergpt.co")?(requireInteraction=!0,je("⚡ Free tier users may experience delays and errors. Please remember to upgrade to access our most capable and intelligent AI agent for faster, error-free performance","Continue","Upgrade",!1).then((e=>{"Upgrade"===e?(Pt(),he(!1),B(!1),F(!1)):n()}))):n()}))):tt(e,t,n)}var o,i}function ne(e){return Promise.all(e.map((e=>new Promise(((t,n)=>{try{e(t,n)}catch(e){n(e)}})))))}function oe(){z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"notificationDisplayed",status:"displayed",apikey:e,currentStateId:setCurrentStateId},"*")}))}function ie(e,t=!1){if(b()&&t){const t={type:"BGPT_INVOKE_EXTENSION",action:"setGlobalTask",task:e,bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(t,"*")}localStorage.setItem("currentTask",JSON.stringify(e)),localStorage.setItem("currentTaskLastUpdated",(new Date).getTime())}function se(){return new Promise((e=>{const t=localStorage.getItem("currentTaskLastUpdated"),n=(new Date).getTime();if(null!=t&&n-t>12e4)e(null);else{const t=localStorage.getItem("currentTask");if(!t||"undefined"===t)return void e(null);try{const n=JSON.parse(t);if(!n)return void e(null);e(n)}catch(t){e(null)}}}))}function re(){return window.__contentScriptActive||null}function ae(){if(setCurrentStateId)return setCurrentStateId;return window.currentStateId||null}function ce(e,t){if(b()||!A()&&v()){const n={type:"BGPT_INVOKE_EXTENSION",action:"setGlobalData",key:e,data:t,bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(n,"*")}else try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}}function le(e=1e4){return new Promise(((t,n)=>{if(setCurrentStateId)return void t(setCurrentStateId);const o=setTimeout((()=>{n(new Error("Timeout waiting for currentStateId"))}),e),i=setInterval((()=>{setCurrentStateId&&(clearInterval(i),clearTimeout(o),t(setCurrentStateId))}),100)}))}function de(e){return new Promise((t=>{let n=C();if(b()||!A()&&v()){if(!n&&!b())return void t(null);setCurrentStateId?ue(e,t):le().then((n=>{ue(e,t)})).catch((e=>{t(null)}))}else try{const n=localStorage.getItem(e);t(n?JSON.parse(n):null)}catch(e){t(null)}}))}function ue(e,t){const n=setTimeout((()=>{t(null)}),3e3);window.addEventListener("getGlobalDataResponse",(function(e){clearTimeout(n),t(e.detail||null)}),{once:!0});const o={type:"BGPT_INVOKE_EXTENSION",action:"getGlobalData",key:e,bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(o,"*")}window.onload=function(){M(),Y();window.location.pathname.includes("/blog")||(K().then((e=>{generalPaymentLink=V(e),window.generalPaymentLink=generalPaymentLink})),S()?z((e=>{x(e)})):b()?z((e=>{L()})):ze("Loading BrowserGPT...",(()=>{setTimeout((()=>{L()}),1e3)})))},window.toggleListening=$,window.toggleCancelMode=F,window.reloadExtension=W,window.addEventListener("message",(function(e){if(e.source===window&&e.data.type&&"BGPT_FROM_EXTENSION"===e.data.type&&"licenseKeyResponse"===e.data.content.action&&(key=e.data.content.message,key)){X(key,!1);const e=new CustomEvent("getLicenseKeyResponse",{detail:key});window.dispatchEvent(e)}})),window.getLicenseKey=z,window.addEventListener("message",(e=>{if(e.source===window&&e.data.type&&"BGPT_FROM_EXTENSION"===e.data.type&&"noNewUpdate"===e.data.content.action){if(e.data.content.stateId!==setCurrentStateId&&null!==setCurrentStateId)return;let t=e.data.content.status,n=localStorage.getItem("bgptLastUpdateRequestTime");localStorage.setItem("bgptLastUpdateRequestTime",(new Date).getTime());const o=(new Date).getTime(),i=36e5;if(!1===t){let s=e.data.content.message;null==n||o-n>i?Xe(s,(()=>{Z(t,s)})):Z(t,s)}else ENABLE_REALTIME_MODE=!0,Z(t,null)}})),window.handleCommonResponseDirectActions=function(e,t=null,n=null){if(e.instructionId||(e.instructionId=Date.now()),instructionId=e.instructionId,A()&&!b()&&!C())return void Se("error","Mobile device detected, direct action not supported",instructionId);ie(e.prompt);let o={status:"success",action:"task_list",tasks:e.tasks,summary:e.summary,reasoning:e.reasoning,prompt:e.prompt,referenced_patterns:{}};z((t=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"captureTab",prompt:e.prompt,data:o,apikey:t,bgptIndex:v(),novaUrl,currentStateId:setCurrentStateId,instructionId,stepsLimit:20,enable_realtime_mode:e.enable_realtime_mode||!1,directExecution:e.directExecution||!1},"*")}))},window.checkExtensionAndEnsureInstalled=ee,window.handleCommonResponseActions=te,window.setData=ce,window.getData=de;let pe=Date.now();let me=null;function we(){return new Promise(((e,t)=>{const n={type:"BGPT_INVOKE_EXTENSION",action:"PING",currentStateId:setCurrentStateId},o=setTimeout((()=>{t(new Error("Ping timeout - no response from content script"))}),5e3),i=function(t){t.data.content,t.source===window&&"PONG"===t.data.content?.action&&(clearTimeout(o),window.removeEventListener("message",i),pe=Date.now(),extensionInstalled=!0,e())};window.addEventListener("message",i),window.postMessage(n,"*")}))}function ge(){const e=Date.now();if(terminateTriggered&&!(terminateTriggeredTime&&e-terminateTriggeredTime>6e5))return;terminateTriggered=!0,terminateTriggeredTime=e,me&&(clearInterval(me),me=null);if(!v()||b()||!setCurrentStateId)throw new Error("BGPT_CONTEXT_INVALID");k(senderAI,"BrowserGPT connection lost. Please refresh the page to reconnect.",!1),requireInteraction=!1,Xe("BrowserGPT connection lost. Please click OK to reconnect.",(e=>{e?(Y(),k(senderAI,"Restarting connection to BrowserGPT...",!1)):window.location.reload()}))}function ye(e,t){const n=e.querySelector(".icon-size");if(isStreaming||e&&e.classList.contains("listening")&&e.classList.remove("listening"),t){e.dataset.originalBgColor||(e.dataset.originalBgColor=e.style.backgroundColor||""),e.dataset.originalColor||(e.dataset.originalColor=e.style.color||""),e.dataset.originalBorder||(e.dataset.originalBorder=e.style.border||""),e.dataset.originalClasses||(e.dataset.originalClasses=e.className),n&&!n.dataset.originalClasses&&(n.dataset.originalClasses=n.className),e.style.backgroundColor="grey",e.style.color="white",e.style.border="none";e.querySelectorAll("i").forEach((e=>{e.classList.contains("spinner-border")||e.classList.contains("fa-spin")||(e.style.display="none")}));let t=e.querySelector(".spinner");if(t)t.style.display="inline-block";else{t=document.createElement("div"),t.className="spinner";const n=document.createElement("div");n.className="spinner-border",t.appendChild(n),e.appendChild(t)}e.classList.add("spinner-mode"),e.classList.add("inactive")}else{e.disabled=!1,e.style.backgroundColor=e.dataset.originalBgColor||"",e.style.color=e.dataset.originalColor||"",e.style.border=e.dataset.originalBorder||"",e.dataset.originalClasses&&(e.className=e.dataset.originalClasses),e.classList.remove("spinner-mode"),e.classList.remove("inactive");e.querySelectorAll("i").forEach((e=>{e.style.display=""}));const t=e.querySelector(".spinner");t&&(t.style.display="none"),n&&n.dataset.originalClasses?n.className=n.dataset.originalClasses:n&&(n.classList.remove("fa-spinner","fa-spin"),n.classList.add("fa-microphone")),se().then((e=>{e&&F(!0)}))}}function he(t,n=null){if(b())n?ye(n,t):(globalButton=e?.querySelector("#sticky-voice-button"),ye(globalButton,t));else{const n=e?.querySelector("#voice-button"),o=n?.querySelector("i"),i=e?.querySelector("#submit-input"),s=i?.querySelector("i");isStreaming||n&&n.classList.contains("listening")&&n.classList.remove("listening"),isRealtimeMode||(t?(n&&(n.style.backgroundColor="grey",n.style.color="white",n.style.border="none",n.classList.add("spinner-mode","inactive"),o&&(o.classList.remove("fa-microphone"),o.classList.add("fa-spinner","fa-spin"))),i&&(i.style.backgroundColor="grey",i.style.color="white",i.style.border="none",i.classList.add("spinner-mode","inactive"),s&&(s.classList.remove("fa-paper-plane"),s.classList.add("fa-spinner","fa-spin")))):(n&&(n.style.backgroundColor="",n.style.color="",n.style.border="",n.classList.remove("spinner-mode","inactive"),o&&(o.classList.remove("fa-spinner","fa-spin"),o.classList.add("fa-microphone"))),i&&(i.style.backgroundColor="",i.style.color="",i.style.border="",i.classList.remove("spinner-mode","inactive"),s&&(s.classList.remove("fa-spinner","fa-spin"),s.classList.add("fa-paper-plane")))))}}function fe(e=null,t=!1){he(!0),I().then((n=>{(b()||!A()&&v())&&function(e,t,n=!1){he(!0);let o=window.location.href;z((i=>{const s={type:"BGPT_INVOKE_EXTENSION",action:"sendQuestion",text:e,conv_history:t,apikey:i,bgptIndex:v(),current_url:o,currentStateId:setCurrentStateId,is_converse_only:n};window.postMessage(s,"*")}))}(e,n,t)})).catch((e=>{Xe("Error processing conversation history for this request. Please try again.")}))}function be(e){"success"===e.status?ee(e):Pe().then((({isFree:e})=>{const t=e?"This request requires a paid plan. Please upgrade to a paid plan to complete your request, click the help button at the bottom right of the screen to get a license key":"Unable to process your instruction at this time!";ne([(e,n)=>Xe(t,e),(e,n)=>He(t,e)]).then((()=>{})).catch((e=>{}))})),he(!1)}function ve(e,t="user",n=!1){window.dispatchEvent(new CustomEvent("send-text-message",{detail:{text:e,type:t,force:n}}))}function Se(e,t,n,o=null){se().then((i=>{n&&!String(n).includes("from_mobile")?window.dispatchEvent(new CustomEvent("send-function-result",{detail:{call_id:n,result:{objective:i,source:"Execution Agent",kind:"Progress Report",status:e,message:t,image:o}}})):ve(`\n\t\t\t\tSource: Execution Agent\n\n\t\t\t\tKind: Progress Report\n\n\t\t\t\tObjective: '${i}'\n\n\t\t\t\tStatus: ${e}\n\n\t\t\t\tMessage: ${t}\n\n\t\t\t\t`,"system")}))}function ke(e){window.currentVoiceButtonTooltip=e,document.documentElement.style.setProperty("--voice-button-tooltip",`"${e}"`)}function Ie(e,t=null){window.dispatchEvent(new CustomEvent(e,{detail:{state:t}}))}function Te(){return new Promise(((e,t)=>{z((e=>{const t={type:"BGPT_INVOKE_EXTENSION",action:"captureScreen",apikey:e,currentStateId:setCurrentStateId,bgptIndex:v()||!1};window.postMessage(t,"*")}));const n=function(t){if(t.source===window&&t.data.type&&"BGPT_FROM_EXTENSION"===t.data.type&&(t.data.content.stateId===setCurrentStateId||null===setCurrentStateId)&&"captureScreenResponse"===t.data.content.action){let n=t.data.content.message;e({image:n.image,description:n.description})}};window.addEventListener("message",n),setTimeout((()=>{window.removeEventListener("message",n),t(new Error("Timeout waiting for screen capture"))}),2e4)}))}async function Ee(e){try{const t="https://gist.githubusercontent.com/mrkeyiano/424090fcf7033db3e7cedf47e579174b/raw",n={available:!0,message:""},o=new AbortController,i=setTimeout((()=>o.abort()),5e3),s=await fetch(t,{signal:o.signal});if(clearTimeout(i),!s.ok)return n;const r=await s.json();if(r&&r.services&&r.services[e]){const t=r.services[e],n="on"===t.status;let o="";return o=n?t.message_on||"":t.message_off||t.message||`${e} service is currently unavailable`,{available:n,message:o}}return n}catch(e){return{available:!0,message:""}}}function Ce(t){const n=()=>{const e=window.location.href,t=new URL(e);return`${t.protocol}//${t.host}`};fetchCarouselItems().then((o=>{if(t){const i=o.filter((e=>e.slug===t));if(i.length>0){const t=i[0].title;if(document.title=`${t} | BrowserGPT`,"markdown"===i[0].type&&i[0].content){let t=e?.querySelector('meta[name="description"]');t||(t=document.createElement("meta"),t.setAttribute("name","description"),document.head.appendChild(t));const n=i[0].content.replace(/[#*_`]/g,"").substring(0,157)+"...";t.setAttribute("content",n)}De(i,t,(e=>{document.title="BrowserGPT - AI Browser Operator | CIVAI",window.location.href=n()}))}else document.title="BrowserGPT Tutorials",De(o,"BrowserGPT Tutorials 🎥",(e=>{document.title="BrowserGPT - AI Browser Operator | CIVAI",window.location.href=n()}))}else document.title="BrowserGPT Tutorials",De(o,"BrowserGPT Tutorials 🎥",(e=>{document.title="BrowserGPT - AI Browser Operator | CIVAI",window.location.href.includes("blog")&&(window.location.href=n())}))})).catch((e=>{alert("Failed to load tutorial content. Please try again later.")}))}function _e(){try{const e=localStorage.getItem("pendingBrowserGPTPrompt");if(!e)return null;const t=JSON.parse(e);return Date.now()>t.expiryTime?(localStorage.removeItem("pendingBrowserGPTPrompt"),null):t.promptData}catch(e){return localStorage.removeItem("pendingBrowserGPTPrompt"),null}}function Le(){return new Promise(((e,t)=>{const n=Q();if(n.source&&(window.novaUrl=n.source),n.tour){window.hideLoadingScreen(),["smartsense","automation","voice"].includes(n.tour)&&(webSocketClient=pt("wss://api.browser.civai.co"),st()),"smartsense"===n.tour?Ne("voice-button","input-container"):Be("voice-button","input-container"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{window.BrowserGPTTargetTours&&window.BrowserGPTTargetTours.start(n.tour)}),1500)})):setTimeout((()=>{window.BrowserGPTTargetTours&&window.BrowserGPTTargetTours.start(n.tour)}),1500)}else if(n.dest)switch(window.hideLoadingScreen(),n.dest.toLowerCase()){case"smartsense":case"hands-free":case"productivity":window.showFeatures&&window.showFeatures();break;case"help":window.toggleHelpTopics&&window.toggleHelpTopics();break;case"how-it-works":window.showFAQ&&window.showFAQ();break;case"subscribe":window.showSubscription&&window.showSubscription();break;case"download":!function(e,t){var n=document.createElement("a");n.href=e,n.target="_blank",n.style.display="none",n.addEventListener("click",(function(e){t&&t(),e.currentTarget.removeEventListener(e.type,arguments.callee)})),document.body.appendChild(n);try{gtag_report_conversion(e)}catch(e){}n.click(),document.body.removeChild(n)}(window.extensionInstallUrl,(()=>{}))}else n.key?X(n.key).then((()=>{z((t=>{x(t),e(t)}))})).catch((t=>{z((t=>{window.isLoadingActive&&window.isLoadingActive()&&window.hideLoadingScreen(),window.showLoadingScreen&&window.showLoadingScreen("Failed to load BrowserGPT, please try again."),e(null)}))})):e(null)}))}if(document.addEventListener("DOMContentLoaded",(()=>{qe()||(me&&clearInterval(me),me=setInterval((async()=>{try{await we()}catch(e){ge()}}),5e3))})),window.BGPT_pingContentScript=we,window.BGPT_terminateContentScript=ge,window.toggleSpinnerMode=he,b()&&window.addEventListener("message",(function(e){if(e.source===window&&e.data.type&&"BGPT_FROM_EXTENSION"===e.data.type){if(e.data.content.stateId!==setCurrentStateId&&null!==setCurrentStateId)return;if("questionResponse"===e.data.content.action){be(e.data.content.message)}}})),window.handleTextPromptResponse=be,window.dispatchMessage=ve,window.dispatchProgressReport=Se,window.updateVoiceButtonTooltip=ke,window.getVoiceButtonTooltip=function(){return window.currentVoiceButtonTooltip},window.addEventListener("voice-button-state-change",(e=>{rt("voice_button_state",{state:e.detail.state,isListening:e.detail.isListening,isRealtime:e.detail.isRealtime,triggeredFromTab:e.detail.triggeredFromTab})})),window.dispatchRealtimeControl=Ie,window.captureCurrentTab=Te,window.validateUrl=async function(e){try{await fetch(e,{method:"HEAD",mode:"no-cors"});return{isValid:!0}}catch(e){return{isValid:!1,error:`URL is not accessible - ${e.message}`}}},window.checkServiceAvailability=Ee,window.shouldShowCarousel=function(){return new Promise((e=>{de("lastBGPTCarouselShownTime").then((t=>{if(!t)return ce("lastBGPTCarouselShownTime",(new Date).getTime()),void e(!0);const n=(new Date).getTime();n-t>=864e5?(ce("lastBGPTCarouselShownTime",n),e(!0)):e(!1)}))}))},window.showTutorials=Ce,window.carouselItems=carouselItems,window.checkPendingPrompt=_e,window.resumePendingPrompt=function(){const e=_e();return!!e&&(ze(e.summary||e.prompt,(()=>{localStorage.removeItem("pendingBrowserGPTPrompt"),A()||v()&&te(e),Qe()&&Je()})),!0)},window.processUrlParams=Le,b()){function xe(){const e=window.shadowRootGlobal;if(!e)return;const t=e.querySelector("#modal-input");t&&(t.style.height="45px",t.addEventListener("input",(function(){!function(e){e.style.height="45px";const t=Math.min(e.scrollHeight,80);e.style.height=t+"px",e.scrollHeight>80?e.style.overflowY="auto":e.style.overflowY="hidden"}(this)})))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",xe):xe(),setTimeout(xe,500)}function Pe(){return new Promise((e=>{z((t=>{const n=!t||"undefined"===t||!1===t,o=t&&"undefined"!==t&&!t.endsWith("@browsergpt.co")&&!t.endsWith("@civai.co"),i=t&&t.endsWith("@civai.co");e({isFree:n,isMonthly:o,isLifetime:i})}))}))}function qe(){if(void 0!==window.ReactNativeWebView)return!0;const e=navigator.userAgent.toLowerCase();return!!(e.includes("reactnative")||e.includes("android")&&e.includes("wv")||e.includes("browsergpt-mobile"))||!(!e.includes("mobile")||!document.referrer.includes("browsergpt")&&!window.location.href.includes("browsergptapp"))}function Ae(e="Start Listening on Mobile"){return new Promise(((t,n)=>{z((o=>{if(!o)return void n(new Error("BrowserGPT Executor is not available"));if("undefined"==typeof webSocketClient||!webSocketClient)return void n(new Error("BrowserGPT Executor is not available"));webSocketClient.sendPing(o,e);const i=Date.now();!function e(){"undefined"!=typeof bgptExecutorIsOnline&&!0===bgptExecutorIsOnline?t():Date.now()-i>1e4?n(new Error("Timeout waiting, BrowserGPT Executor is not available")):setTimeout(e,100)}()}))}))}function Ne(...t){t.forEach((t=>{const n=e?.querySelector(`#${t}`);n&&n.style.setProperty("display","none","important")}));const n=e?.querySelector("#smartsense-button");if(n&&n.style.setProperty("display","","important"),window.innerWidth<=600){const t=e?.querySelector("#chat-container");t&&t.style.setProperty("max-height","95%","important");const n=e?.querySelector(".content-area");n&&n.style.setProperty("gap","55px","important")}}function Be(...t){t.forEach((t=>{const n=e?.querySelector(`#${t}`);n&&n.style.setProperty("display","","important")}));const n=e?.querySelector("#smartsense-button");if(n&&n.style.setProperty("display","none","important"),window.innerWidth<=600){const t=e?.querySelector("#chat-container");t&&t.style.setProperty("max-height","","important");const n=e?.querySelector(".content-area");n&&n.style.setProperty("gap","","important")}}function Me(e,t,n,o){const i=new AbortController,s=setTimeout((()=>i.abort()),3e4),r=new FormData;z((a=>{if(!o||"string"!=typeof o||!o.includes("/"))return Oe(new Error("Invalid MIME type provided.")),e.disabled=!1,void(e.style.backgroundColor="");{const a=o.split("/")[1].split(";")[0];r.append("audio",n,"recording."+a),r.append("conv_history",t),r.append("is_follow_up",!1),r.append("current_url",currentUrl),z((t=>{fetch("https://api.browser.civai.co/voice_prompt",{method:"POST",headers:{"Bgpt-License-Key":t},body:r,signal:i.signal}).then((e=>{if(clearTimeout(s),!e.ok)throw 403===e.status?new Error("Access forbidden: Invalid license key or insufficient permissions."):new Error("HTTP error: "+e.status);return e.json()})).then((t=>{Re(t,e)})).catch((e=>{"AbortError"===e.name?Oe(new Error("Request timed out.")):Oe(e)})).finally((()=>{e.disabled=!1,e.style.backgroundColor=""}))}))}}))}function Oe(e){e.message&&(e.message.includes("Access forbidden")||e.message.includes("Failed to fetch"))?(B(!1),F(!1),he(!1),P()):(requireInteraction=!1,["Access forbidden","Failed to fetch"].includes(e)?(Xe("There was a problem connecting to browserGPT at this time."),B(!1),F(!1),he(!1),P()):(Pe().then((({isFree:e})=>{Xe(e?"This request requires a paid plan. Please upgrade to a paid plan to complete your request, click the help button at the bottom right of the screen to get a license key":"There was a problem connecting to browserGPT at this time.")})),B(!1),F(!1),he(!1)))}function Ge(e){try{const t=new URL(e);return t.hostname.includes("browser.civai.co")||t.hostname.includes("browsergpt.co")?null:t.hostname.replace(/^www\./,"")}catch(e){return null}}function Re(t,n){const o=e?.querySelector("#input-text"),i=e?.querySelector(".bubble");"success"===t.status?(n.style.backgroundColor="",k(senderUser,t.query),b()||v()&&!A()?ee(t,o,i):te(t,o,i)):Oe(new Error("Error: "+t.error))}function He(t,n){isStreaming||isListening?n&&n():new Promise((e=>{const t=setInterval((()=>{globalAudio&&isAudioPlaying?(globalAudio.pause(),globalAudio.currentTime=0,isAudioPlaying=!1,e()):isAudioPlaying||(clearInterval(t),e())}),5)})).then((()=>{isAudioPlaying=!0,function(t,n){if(!A()&&(b()||v())&&C())!function(t,n){const o=e?.querySelector(".bubble");o&&(o.textContent="...");z((e=>{const n={type:"BGPT_INVOKE_EXTENSION",action:"sendTts",text:t,apikey:e,bgptIndex:v(),currentStateId:setCurrentStateId,enable_realtime_mode:!!isStreaming};window.postMessage(n,"*")})),!initializationTriggered&&v()&&se().then((e=>{null===e&&B(!0)}));let i;const s=o=>{if(clearTimeout(i),o.detail.played){const o=e?.querySelector(".bubble");o&&(o.textContent="",E(o,t,0)),se().then((e=>{null===e&&B(!1)})),isAudioPlaying=!1,n&&n()}else{const i=e?.querySelector(".bubble");i&&(i.textContent="",E(i,t,0)),o.detail.isBrowserGPTIndex?$e(o.detail.text,o.detail.audio,(()=>{n&&n()})):Ue(o.detail.text,o.detail.audio,(()=>{n&&n()}))}};window.addEventListener("ttsResponse",s,{once:!0}),i=setTimeout((()=>{window.removeEventListener("ttsResponse",s),k(senderAI,"Audio playback failed, didnt get audio response from browsergpt"),n&&n()}),6e4)}(t,(()=>{n&&n()}));else{let o=e?.querySelector(".bubble");o&&(o.textContent="..."),function(t,n){z((o=>{!1!==o?fetch("https://api.browser.civai.co/tts",{method:"POST",headers:{"Content-Type":"application/json","Bgpt-License-Key":o},body:JSON.stringify({text:t})}).then((e=>{if(!e.ok)throw 403===e.status?new Error("Access forbidden: Invalid license key or insufficient permissions."):new Error("HTTP error: "+e.status);return e.blob()})).then((o=>{const i=new FileReader;B(!1),i.onloadend=()=>{url=i.result;let o=e?.querySelector(".bubble");o&&(o.textContent="",E(o,t,0)),$e(t,url,(()=>{n&&n()}))},i.readAsDataURL(o)})).catch((e=>{B(!1),isAudioPlaying=!1,Oe(e)})):(B(!1),isAudioPlaying=!1)}))}(t,(()=>{n&&n()}))}}(t,(()=>{n&&n()}))}))}function $e(e,t,n){if(!initializationTriggered&&v()&&B(!0),isRealtimeMode)return void(n&&n());!function(e){const t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],o=new Array(t.length);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);const i=new Uint8Array(o);new Blob([i],{type:n})}(t);globalAudio.src=t,globalAudio.play().catch((o=>{A()?(isAudioPlaying=!1,playAudioFailureAlert||(k(senderAI,`Unable to play audio on this device, got this error: ${o}`),k(senderAI,"Please try again on a new tab"),playAudioFailureAlert=!0),n&&n()):Ue(e,t,(()=>{isAudioPlaying=!1,n&&n()}))})),globalAudio.onended=()=>{B(!1),isAudioPlaying=!1,n&&n()}}function Ue(e,t,n){z((e=>{const n={type:"BGPT_INVOKE_EXTENSION",action:"playAudio",url:t,apikey:e,bgptIndex:v(),currentStateId:setCurrentStateId};window.postMessage(n,"*")}));const o=setTimeout((()=>{B(!1),isAudioPlaying=!1,n&&n()}),3e5);window.addEventListener("audioPlaybackEnded",(function(){B(!1),isAudioPlaying=!1,clearTimeout(o),n&&n()}),{once:!0})}function De(t,n="Carousel",o=null){function i(e){return e?marked.parse(e):""}function s(e){if(e.scrollHeight>e.clientHeight){const t=document.createElement("div");t.className="scroll-indicator",t.innerHTML='<i class="fas fa-chevron-down"></i>',e.parentNode.appendChild(t),t.addEventListener("click",(()=>{e.scrollBy({top:300,behavior:"smooth"})})),e.addEventListener("scroll",(()=>{e.scrollHeight-e.scrollTop-e.clientHeight<20?t.style.display="none":t.style.display="flex"}))}}Array.isArray(t)&&0!==t.length&&We().then((()=>{isModalShowing=!0;const n=e?.querySelector("#modal"),r=e?.querySelector("#modal-text"),a=e?.querySelector("#close-modal"),c=e?.querySelector("#cancel-button"),l=n.querySelector(".modal-content"),d=t.some((e=>"markdown"===e.type)),u=A();d&&(u?(r.style.width="95vw",r.style.maxWidth="95%",l&&(l.style.maxWidth="90vw",l.style.width="95%",l.style.backgroundColor="rgb(21, 25, 30)")):(r.style.width="65vw",r.style.maxWidth="80%",l&&(l.style.maxWidth="55vw",l.style.width="80%",l.style.backgroundColor="rgb(21, 25, 30)"))),r.innerHTML="",f&&f.classList.add("hidden"),c&&c.classList.add("hidden");const p=document.createElement("h2");p.textContent="",d&&(p.style.textAlign="center",p.style.marginBottom="1.5rem"),r.appendChild(p);const m=document.createElement("div");m.className="carousel-container";const w=document.createElement("div");if(w.className="carousel-content",t.forEach(((e,t)=>{const n=document.createElement("div");n.className="carousel-item",n.style.display=0===t?"block":"none";const o=document.createElement("div");o.className="loading-spinner";const r=document.createElement("h3");if(r.textContent=e.title,r.style.marginBottom="20px",r.style.marginTop="15px",r.style.textAlign="center",n.appendChild(r),"markdown"===e.type){const e=document.createElement("div");e.style.width="60px",e.style.height="3px",e.style.backgroundColor="#04A492",e.style.margin="0 auto 1.5rem",e.style.borderRadius="2px",n.appendChild(e)}if(n.appendChild(o),"image"===e.type){const t=document.createElement("img");t.src=e.url,t.alt=e.title||"Image",t.style.width="100%",t.style.borderRadius="10px",t.style.display="none",t.onload=()=>{o.style.display="none",t.style.display="block"},t.onerror=()=>{o.style.display="none";const e=document.createElement("p");e.textContent="Failed to load image.",e.style.color="red",n.appendChild(e)},n.appendChild(t)}else if("video"===e.type){const t=document.createElement("iframe");t.src=`${e.url}?autoplay=1&mute=1`,t.frameBorder="0",t.allow="autoplay; encrypted-media",t.allowFullscreen=!0,t.style.width="100%",t.style.height="315px",t.style.display="none",t.onload=()=>{o.style.display="none",t.style.display="block"},t.onerror=()=>{o.style.display="none";const e=document.createElement("p");e.textContent="Failed to load video.",e.style.color="red",n.appendChild(e)},n.appendChild(t)}else if("markdown"===e.type){const t=document.createElement("div");t.className="markdown-content",t.style.width="100%",t.style.maxHeight="50vh",t.style.overflowY="auto",t.style.padding="0.5rem 2rem",t.style.borderRadius="10px",t.style.display="none",e.content?(o&&(o.style.display="none",o.classList.add("hidden")),t.style.display="block",t.innerHTML=i(e.content),setTimeout((()=>{s(t)}),100)):e.url&&fetch(e.url).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()})).then((e=>{o&&(o.style.display="none",o.classList.add("hidden")),t.style.display="block",t.innerHTML=i(e),setTimeout((()=>{s(t)}),100)})).catch((e=>{o&&(o.style.display="none",o.classList.add("hidden"));const t=document.createElement("p");t.textContent="Failed to load markdown content: "+e.message,t.style.color="red",n.appendChild(t)})),n.appendChild(t),function(e,t){if("markdown"!==e.type)return;const n=document.createElement("div");n.className="share-buttons-container";const o=document.createElement("div");o.className="share-text",o.textContent="Share",n.appendChild(o);const i=`${window.location.origin}/blog/${e.slug}`,s=e.title;[{name:"Facebook",icon:"fab fa-facebook-f",url:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(i)}&t=${encodeURIComponent(s)}`},{name:"Twitter",icon:"fab fa-twitter",url:`https://twitter.com/intent/tweet?text=${encodeURIComponent(s)}&url=${encodeURIComponent(i)}`},{name:"WhatsApp",icon:"fab fa-whatsapp",url:`https://api.whatsapp.com/send?text=${encodeURIComponent(s+" "+i)}`},{name:"Telegram",icon:"fab fa-telegram-plane",url:`https://t.me/share/url?url=${encodeURIComponent(i)}&text=${encodeURIComponent(s)}`},{name:"LinkedIn",icon:"fab fa-linkedin-in",url:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(i)}`}].forEach((e=>{const t=document.createElement("a");t.className="share-button",t.setAttribute("title",`Share on ${e.name}`),t.setAttribute("aria-label",`Share on ${e.name}`),t.href=e.url,t.target="_blank",t.rel="noopener noreferrer";const o=document.createElement("i");o.className=e.icon,t.appendChild(o),n.appendChild(t)})),t.appendChild(n)}(e,n)}w.appendChild(n)})),m.appendChild(w),t.length>1){const n=document.createElement("div");n.className="modal-carousel-navigation";const o=document.createElement("button");o.textContent="←",o.className="modal-carousel-nav";const i=document.createElement("button");i.textContent="→",i.className="modal-carousel-nav",n.appendChild(o),n.appendChild(i);const s=e?.querySelector("#modal-footer");s?s.appendChild(n):m.appendChild(n);let r=0;const a=n=>{const o=e?.querySelectorAll(".carousel-item"),i=o[r].querySelector("iframe");i&&(i.src=""),o[r].style.display="none";const s=o[r].querySelector(".loading-spinner");s&&(s.style.display="block"),r=(r+n+t.length)%t.length,o[r].style.display="block";const a=o[r],c=a.querySelector(".loading-spinner");c&&(c.style.display="block");const l=o[r].querySelector("iframe");if(l){const e=t[r].url;l.src=`${e}?autoplay=1&mute=1`,l.style.display="none",l.onload=()=>{c&&(c.style.display="none"),l.style.display="block"},l.onerror=()=>{c&&(c.style.display="none");const e=document.createElement("p");e.textContent="Failed to load video.",e.style.color="red",a.appendChild(e)}}const d=o[r].querySelector("img");d&&(d.onload=()=>{c&&(c.style.display="none"),d.style.display="block"},d.onerror=()=>{c&&(c.style.display="none");const e=document.createElement("p");e.textContent="Failed to load image.",e.style.color="red",a.appendChild(e)});const u=o[r].querySelector(".markdown-content");u&&(c&&(c.style.display="none",c.classList.add("hidden")),u.style.display="block")};o.onclick=()=>a(-1),i.onclick=()=>a(1)}r.appendChild(m),a&&(a.onclick=()=>{l&&(l.style.maxWidth="",l.style.width=""),Ve(!0),o&&o({action:"close-button"}),f.classList.remove("hidden"),r.style.width="",r.style.maxWidth=""}),c&&(c.onclick=()=>{l&&(l.style.maxWidth="",l.style.width=""),Ve(),o&&o({action:"cancel-button"}),r.style.width="",r.style.maxWidth="",f.classList.remove("hidden")}),n.onclick=e=>{e.target===n&&(l&&(l.style.maxWidth="",l.style.width=""),Ve(),o&&o({action:"click-outside"}),r.style.width="",r.style.maxWidth="",f.classList.remove("hidden"))},n.classList.remove("hidden")}))}function Fe(t){if(t){const t=e?.querySelector("#modal-input"),n=e?.querySelector("#modal-input-container");if(t&&!t.disabled&&null!==t.offsetParent&&n&&!n.classList.contains("hidden")){t.style.pointerEvents="auto",n.style.pointerEvents="auto",t._clickHandler&&t.removeEventListener("click",t._clickHandler),t._clickHandler=function(e){setTimeout((()=>this.focus()),0)},t.addEventListener("click",t._clickHandler),t.removeEventListener("keydown",t._keydownHandler),t.removeEventListener("keyup",t._keyupHandler),t.removeEventListener("keypress",t._keypressHandler),t._keydownHandler=null,t._keyupHandler=null,t._keypressHandler=null;const e=()=>{t.focus()};e(),setTimeout(e,50),setTimeout(e,100),setTimeout(e,300)}}else{const t=e?.querySelector("#modal-input");t&&(t._keydownHandler&&(t.removeEventListener("keydown",t._keydownHandler),delete t._keydownHandler),t._keyupHandler&&(t.removeEventListener("keyup",t._keyupHandler),delete t._keyupHandler),t._keypressHandler&&(t.removeEventListener("keypress",t._keypressHandler),delete t._keypressHandler),t._clickHandler&&(t.removeEventListener("click",t._clickHandler),delete t._clickHandler))}}function Ke(t,n="alert",o="",i="Yes",s="No"){We().then((()=>{v()&&window.BrowserGPTMiniOnboarding.close(),isModalShowing=!0;const r=e?.querySelector("#modal");r.classList.remove("hidden"),Fe(!0);const a=e?.querySelector("#modal-text"),c=e?.querySelector("#ok-button"),l=e?.querySelector("#cancel-button");c&&c?.classList&&c.classList.remove("hidden"),l&&l?.classList&&l.classList.remove("hidden"),modalInputContainer=e?.querySelector("#modal-input-container"),modalInput=e?.querySelector("#modal-input"),c&&("input"===n?(modalInputContainer&&modalInputContainer?.classList&&modalInputContainer.classList.remove("hidden"),modalInput&&(modalInput.value="",modalInput.placeholder=o),l.textContent="BUY NOW",c.textContent="CONFIRM",l.classList.remove("hidden"),a.innerHTML=t):"question"===n?(modalInputContainer&&modalInputContainer?.classList&&modalInputContainer.classList.remove("hidden"),modalInput&&(modalInput.value="",modalInput.placeholder=o),c.textContent="REPLY",a.innerHTML=t):"option"===n?(a.innerHTML=t,c.textContent=i,l.textContent=s,l.classList.remove("hidden"),modalInputContainer&&modalInputContainer?.classList&&modalInputContainer.classList.add("hidden")):"confirm"===n?(a.innerHTML=t,c.textContent="Confirm",l.textContent="Cancel",modalInputContainer&&modalInputContainer?.classList&&modalInputContainer.classList.add("hidden")):(a.textContent="",a.innerHTML=t,c.textContent="Ok",l.classList.add("hidden"),modalInputContainer&&modalInputContainer?.classList&&modalInputContainer.classList.add("hidden")))}))}function Ve(t=!1){const n=e?.querySelector("#modal"),o=e?.querySelector("#cancel-button"),i=n?.querySelector(".modal-content");modalInputContainer=e?.querySelector("#modal-input-container"),modalInput=e?.querySelector("#modal-input"),Fe(!1),i&&(i.style.maxWidth="",i.style.width=""),n&&(!1===t?("buy now"==o?.textContent.toLowerCase()||j()||n.classList.add("hidden"),isModalShowing=!1):(n.classList.add("hidden"),isModalShowing=!1)),isModalShowing=!1,o?.classList&&o.classList.add("hidden"),modalInputContainer?.classList&&modalInputContainer.classList.add("hidden"),n?.classList&&n.classList.add("hidden"),modalInput&&(modalInput.removeEventListener("keydown",(e=>{})),modalInput.removeEventListener("keyup",(e=>{})),modalInput.removeEventListener("keypress",(e=>{})))}function je(t,n="Yes",o="No",i=!1){return new Promise(((i,s)=>{!A()&&b()||!b()&&v()?(novaAgentMode?delayTime=4e4:delayTime=2e4,ot(t,!0).then((()=>{Ke(t,"option","",n,o)})).catch((e=>{Ke(t,"option","",n,o)}))):(delayTime=1e4,Ke(t,"option","",n,o));const r=e?.querySelector("#ok-button"),a=e?.querySelector("#cancel-button");let c=null;const l=e=>{A||webSocketClient.setCurrentAlertId(null),clearTimeout(c),r.onclick=null,a.onclick=null,Ve(!0),i(e)};r.textContent=n,a.textContent=o,a.classList.remove("hidden"),r.onclick=()=>l(n),a.onclick=()=>l(o),requireInteraction||(c=setTimeout((()=>l("")),delayTime))}))}function Xe(t,n){const o=e?.querySelector("#ok-button");let i=1e4,s=null;o&&(!A()&&b()?(i=!1===requireInteraction&&novaAgentMode?5e3:1e4,ot(t,!1).then((()=>{Ke(t,"alert")})).catch((e=>{Ke(t,"alert")}))):A()||b()||!v()?Ke(t,"alert"):novaAgentMode?(i=5e3,Ke(t,"alert")):(i=2e4,Ke(t,"alert")),requireInteraction||(s=setTimeout((()=>{o.onclick=null,Ve(!0),n&&n(!0)}),i)),o.onclick=()=>{requireInteraction||clearTimeout(s),o.onclick=null,Ve(!0),n&&n(!0)})}function Ye(t,n){return new Promise(((n,o)=>{A()||!b()&&!v()?(delayTime=1e4,Ke(t,"confirm")):(novaAgentMode?delayTime=4e4:delayTime=6e4,ot(t,!0).then((()=>{Ke(t,"confirm")})).catch((e=>{Ke(t,"confirm")})));const i=e?.querySelector(".bubble");i&&(i.textContent=t);const s=e?.querySelector("#ok-button"),r=e?.querySelector("#cancel-button");let a=null;const c=e=>{Ve(),licenseAlertShown=!1,A||webSocketClient.setCurrentAlertId(null),requireInteraction||clearTimeout(a),s.onclick=null,r.onclick=null,e?n(e):o(e)};s.onclick=()=>c(!0),requireInteraction||(a=setTimeout((()=>c(!1)),delayTime))}))}function We(){return new Promise((e=>{const t=setInterval((()=>{isModalShowing||(clearInterval(t),e())}),200);setTimeout((()=>{clearInterval(t),e()}),1e4)}))}function ze(t="Loading...",n=null){We().then((()=>{window.isLoadingScreenActive=!0;const o=e?.querySelector("#modal"),i=e?.querySelector("#modal-text"),s=e?.querySelector(".modal-content"),r=e?.querySelector("#close-modal"),a=e?.querySelector("#ok-button"),c=e?.querySelector("#cancel-button"),l=e?.querySelector("#modal-input-container");if(r&&r.classList.add("hidden"),a&&a.classList.add("hidden"),c&&c.classList.add("hidden"),l&&l.classList.add("hidden"),i){i.innerHTML="",i.style.width="auto",i.style.maxWidth="80%";const e=document.createElement("div");if(e.className="loading-spinner",e.style.width="50px",e.style.height="50px",e.style.margin="20px auto",i.appendChild(e),t){const e=document.createElement("p");e.textContent=t,e.style.textAlign="center",e.style.margin="20px 0",i.appendChild(e)}}s&&(s.classList.contains("loading-screen")||s.classList.add("loading-screen")),o&&(o.style.pointerEvents="all",o.onclick=null,o.classList.remove("hidden"),n&&n())}))}function Je(){e?.querySelector("#modal");const t=e?.querySelector(".modal-content");e?.querySelector("#close-modal"),e?.querySelector("#ok-button");t&&t.classList.contains("loading-screen")&&t.classList.remove("loading-screen"),Ve(!0),window.isLoadingScreenActive=!1}function Qe(){return window.isLoadingScreenActive}window.getSubscriptionType=Pe,window.isPlatformReactNative=qe,window.waitForExecutorOnlineAndPing=Ae,window.sendUpdateSuggestions=function(e,t=!1){const n=e.map((e=>"string"==typeof e?{instruction:e,action:"do_nothing"}:e));z((e=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"updateSuggestions",suggestions:n,showLoading:t,bgptIndex:v(),currentStateId:setCurrentStateId},"*")}))},window.hideElementsById=Ne,window.showElementsById=Be,window.waitForSuggestions=function(e=3e4){return new Promise((t=>{let n;const o=e=>{e&&e.message&&"updateSuggestions"===e.message.key&&Array.isArray(e.message.value)&&(window.webSocketClient&&"function"==typeof window.webSocketClient.socket?.off&&window.webSocketClient.socket.off("broadcast",o),clearTimeout(n),t(e.message.value))};window.webSocketClient&&window.webSocketClient.socket?(window.webSocketClient.socket.once("broadcast",o),n=setTimeout((()=>{window.webSocketClient&&"function"==typeof window.webSocketClient.socket?.off&&window.webSocketClient.socket.off("broadcast",o),t(null)}),e)):setTimeout((()=>t(null)),e)}))},window.addEventListener("message",(function(t){if(t.source===window&&t.data.type&&"BGPT_FROM_EXTENSION"===t.data.type)if("invalid_key"!==t.data.content.status){if(t.data.content.stateId!==setCurrentStateId&&null!==setCurrentStateId)return;if(data=t.data.content.message,bgptIndex=t.data.content.bgptIndex,bgptIndex!==v())return;if(b()&&v())return;if("audioResponse"===t.data.content.action&&(button=e?.querySelector(`#${data.button_id}`),button&&Re(data,button)),"ttsResponse"===t.data.content.action)if(response=t.data.content.message,"success"===t.data.content.status){const e=new CustomEvent("ttsResponse",{detail:{text:response.text,audio:response.audio,fast:response.fast,isBrowserGPTIndex:v(),played:response.played}});window.dispatchEvent(e)}else requireInteraction=!1,Xe("There was a problem connecting to browserGPT."),B(!1),F(!1),he(!1),isAudioPlaying=!1}else"invalid_key"===t.data.content.status&&(B(!1),isAudioPlaying=!1)})),window.addEventListener("message",(e=>{e.source===window&&e.data.type&&"BGPT_FROM_EXTENSION"===e.data.type&&("resetResponse"===e.data.content.action&&ge(),e.data.content.stateId!==setCurrentStateId&&null!==setCurrentStateId||("playAudioEnded"===e.data.content.action?window.dispatchEvent(new CustomEvent("audioPlaybackEnded")):"getGlobalTaskResponse"===e.data.content.action?window.dispatchEvent(new CustomEvent("getGlobalTaskResponse",{detail:e.data.content.message})):"getGlobalDataResponse"===e.data.content.action&&window.dispatchEvent(new CustomEvent("getGlobalDataResponse",{detail:e.data.content.message}))))})),window.hideModal=Ve,window.showAlert=Xe,window.waitForModalToFinish=We;const Ze=document.createElement("style");function et(e,t=!1){if(!e)return;Fe(!1);const n=e.querySelector("#cancel-button"),o=e.querySelector(".modal-content"),i=e.querySelector("#modal-input-container"),s=e.querySelector("#modal-input");o&&(o.style.maxWidth="",o.style.width=""),e&&(!1===t&&n&&("buy now"==n.textContent.toLowerCase()||j())||e.classList.add("hidden")),n?.classList&&n.classList.add("hidden"),i?.classList&&i.classList.add("hidden"),e?.classList&&e.classList.add("hidden"),s&&(s.removeEventListener("keydown",(e=>{})),s.removeEventListener("keyup",(e=>{})),s.removeEventListener("keypress",(e=>{})))}function tt(e,t=null,n=null){let o=e.prompt;e.url;e.message&&(e.prompt=e.message),"smartsense"===e.prompt&&(message="BrowserGPT Desktop has been notified of your request. You will receive a response shortly.",e.prompt=message),B(!1),B(!1,"submit-input"),new Promise(((e,t)=>{Ae().then((()=>{z((n=>{fetch("https://api.browser.civai.co/is_queue_empty",{method:"POST",headers:{"Content-Type":"application/json","Bgpt-License-Key":n},body:JSON.stringify({email:n})}).then((e=>e.json())).then((n=>!0===n.is_empty?void e():void t(new Error("⏰ Task Queue is currently full, please try again later")))).catch((e=>{He(`Error occurred. ${e}`,(()=>{t(new Error("Error occurred in request queue check. Please try again later"))}))}))}))})).catch((e=>{He(e.message||e,(()=>{t(new Error("⏰ To process your request, please install the BrowserGPT extension on your desktop browser & ensure the tab is open"))}))}))})).then((()=>{z((t=>{fetch("https://api.browser.civai.co/add_prompt",{method:"POST",headers:{"Content-Type":"application/json","Bgpt-License-Key":t},body:JSON.stringify({prompt:o,email:t})}).then((e=>e.json())).then((t=>{ne([(t,n)=>k(senderAI,e.prompt)]).then((()=>{})).catch((e=>Promise.reject("Failed to process mobile prompt. Please try again later.")))})).catch((e=>{He(`Error occurred. ${e}`),k(senderAI,e.message)}))}))})).catch((e=>{let t="";t=e.message.includes("please install the BrowserGPT")?`\n\n[Install BrowserGPT Extension](${window.extensionInstallUrl})`:"",k(senderAI,e.message+t),Xe(e.message,(()=>{He(e.message,(()=>{}))})),Se("error",`\n\t\t\tUser is on mobile device and trying to use BrowserGPT.\n\n\t\t\tBrowserGPT on mobile sends mobile requests to BrowserGPT Agent on their Desktop to execute browser actions.\n\n\t\t\tUser must have BrowserGPT extension installed on their desktop browser with Chrome Running so as to allow BrowserGPT Agent to listen for mobile requests.\n\n\t\t\tMobile requests are not processed if BrowserGPT Agent is not running on the desktop.\n\t\t\t\n\t\t\tCurrent Status: ${e.message}\n\t\t\t\n\t\t\t`,instructionId)}))}Ze.textContent="\n\t.loading-screen {\n\t\tbackground-color: rgba(0, 0, 0, 0.8) !important;\n\t\twidth: 100% !important;\n\t\theight: 100% !important;\n\t\tmax-width: 100% !important;\n\t\tmax-height: 100% !important;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\ttransition: all 0.3s ease;\n\t\tborder-radius: 0 !important;\n\t\tbox-shadow: none !important;\n\t}\n\t\n\t.loading-screen * {\n\t\tcolor: white !important;\n\t}\n\t\n\t/* Additional spinner animation for loading screen */\n\t.loading-screen .loading-spinner {\n\t\tborder: 5px solid rgba(255, 255, 255, 0.2);\n\t\tborder-top: 5px solid white;\n\t\tborder-radius: 50%;\n\t\twidth: 50px;\n\t\theight: 50px;\n\t\tanimation: spin 1s linear infinite;\n\t}\n\t\n\t@keyframes spin {\n\t\t0% { transform: rotate(0deg); }\n\t\t100% { transform: rotate(360deg); }\n\t}\n\t\n\t/* Share buttons styles */\n\t.share-buttons-container {\n\t\tposition: fixed;\n\t\tleft: 10px;\n\t\ttop: 50%;\n\t\ttransform: translateY(-50%);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 15px;\n\t\tz-index: 1000;\n\t\tbackground-color: rgba(30, 35, 40, 0.8);\n\t\tpadding: 5px 5px;\n\t\tborder-radius: 30px;\n\t\tbox-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);\n\t}\n\t\n\t.share-text {\n\t\tcolor: white;\n\t\tfont-size: 12px;\n\t\tfont-weight: bold;\n\t\ttext-align: center;\n\t\tmargin-bottom: 5px;\n\t}\n\t\n\t.share-button {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\twidth: 40px;\n\t\theight: 40px;\n\t\tborder-radius: 50%;\n\t\tcolor: white;\n\t\tfont-size: 18px;\n\t\ttext-decoration: none;\n\t\ttransition: all 0.2s ease;\n\t}\n\t\n\t.share-button:hover {\n\t\ttransform: scale(1.1);\n\t}\n\t\n\t.share-button i {\n\t\tcolor: white;\n\t}\n\t\n\t/* Social media specific colors */\n\t.share-button:nth-child(2) { background-color: #3b5998; } /* Facebook */\n\t.share-button:nth-child(3) { background-color: #1da1f2; } /* Twitter */\n\t.share-button:nth-child(4) { background-color: #25D366; } /* WhatsApp */\n\t.share-button:nth-child(5) { background-color: #0088cc; } /* Telegram */\n\t.share-button:nth-child(6) { background-color: #0077b5; } /* LinkedIn */\n\t\n\t/* Responsive adjustments for mobile */\n\t@media (max-width: 768px) {\n\t\t.share-buttons-container {\n\t\t\tposition: fixed;\n\t\t\tleft: 10px;\n\t\t\ttop: 50%;\n\t\t\ttransform: translateY(-50%);\n\t\t\tflex-direction: column;\n\t\t\tgap: 10px;\n\t\t\tpadding: 5px 5px;\n\t\t\tborder-radius: 30px;\n\t\t\twidth: auto;\n\t\t\tmargin-top: 0;\n\t\t}\n\t\t\n\t\t.share-text {\n\t\t\tdisplay: none;\n\t\t}\n\t\t\n\t\t.share-button {\n\t\t\twidth: 35px;\n\t\t\theight: 35px;\n\t\t\tfont-size: 16px;\n\t\t}\n\t}\n",document.head.appendChild(Ze),window.showLoadingScreen=ze,window.hideLoadingScreen=Je,window.isLoadingActive=Qe,window.handleMobilePrompt=tt;let nt=function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<e;o++)n+=t.charAt(Math.floor(62*Math.random()));return n}(8);function ot(e,t,n=!1){return new Promise(((o,i)=>{if(webSocketClient&&webSocketClient.isConnected()&&(novaAgentMode||overrideNovaAgentMode)){let s=novaAgentMode?5e3:3e3;try{z((o=>{const i={event:"mobile_message_queue",channel_id:o,message:{text:e,is_question:t,is_chat:n}};webSocketClient.sendEmit("bgpt_notifications",i)})),setTimeout((()=>{o()}),s)}catch(e){setTimeout((()=>{i()}),s)}}else o()}))}function it(e,t="success"){return new Promise(((e,n)=>{instructionId?z((o=>{fetch("https://api.browser.civai.co/browser_task_completed",{method:"POST",headers:{"Content-Type":"application/json","Bgpt-License-Key":o},body:JSON.stringify({instruction_id:String(instructionId),status:t})}).then((e=>e.json())).then((t=>{v()&&renderTasks(),e()})).catch((e=>{n(e)}))})):e()}))}function st(){(A()||!b()&&v()||!b()&&S())&&(S()?z((e=>{webSocketClient.isConnected()?webSocketClient.sendPing(e,"Start Listening on Mobile"):webSocketClient.socket.once("connect",(()=>{webSocketClient.sendPing(e,"Start Listening on Mobile")}))})):z((e=>{webSocketClient.isConnected()?(webSocketClient.sendPing(e,"Start Listening on Mobile"),pingExtension=!0):webSocketClient.socket.once("connect",(()=>{webSocketClient.sendPing(e,"Start Listening on Mobile"),pingExtension=!0}))})))}function rt(e,t){try{webSocketClient&&webSocketClient.isConnected()?at(e,t):(webSocketClient=pt("wss://api.browser.civai.co"),setTimeout((()=>{webSocketClient.ensureConnected(),at(e,t)}),3e3))}catch(e){}}function at(e,t){z((n=>{webSocketClient.sendEmit("bgpt_notifications",{event:"broadcast",channel_id:n,message:{key:e,value:t}})}))}function ct(){browserSocketStarted?remoteTaskTriggered||ut():(browserSocketStarted=!0,z((e=>{null!==e&&(webSocketClient?z((e=>{webSocketClient.createChannel(e)})):(webSocketClient=pt("wss://api.browser.civai.co"),z((e=>{webSocketClient.isConnected()?webSocketClient.createChannel(e):webSocketClient.socket.once("connect",(()=>{webSocketClient.createChannel(e)}))}))),ut())})))}function lt(){currentTask=null,instructionId=null,ie(null)}async function dt(){null!==await se()&&webSocketClient&&webSocketClient.isConnected()&&(webSocketClient.closeConnection(),browserSocketStarted=!1),remoteTaskTriggered=!1}async function ut(){for(;;){try{remoteTaskTriggered||(remoteTaskTriggered=!0);let e=await se();if(null===setContentScriptActive&&null===setCurrentStateId)setContentScriptActive=re(),setCurrentStateId=ae();else if(setContentScriptActive!==re())throw window.stop(),new Error("Content script is no longer active");if(novaAgentMode&&v()&&null==e||overrideNovaAgentMode&&null==e)webSocketClient?"function"==typeof webSocketClient.isConnected&&webSocketClient.isConnected()?(D(!0),z((e=>{webSocketClient.sendMessage({command:"browser_init",api_key:e,connection_id:nt,current_url:window.location.href})}))):webSocketClient.ensureConnected():webSocketClient=pt("wss://api.browser.civai.co");else if(!overrideNovaAgentMode){bgptExecutorIsOnline=!1,dt();break}}catch(e){if("Content script is no longer active"===e.message)throw webSocketClient.closeConnection(),browserSocketStarted=!1,bgptExecutorIsOnline=!1,overrideNovaAgentMode=!1,remoteTaskTriggered=!1,e}await new Promise((e=>setTimeout(e,5e3)))}}function pt(e){return new WebSocketClient(e)}setContentScriptActive=re(),setCurrentStateId=ae(),window.WebSocketClient=class t{constructor(e){if(t.instance)return t.instance;this.url=e,this.socket=null,this.currentAlertId=null,this.eventListenersAdded=!1,this.subscribedChannels=new Set,this.connect(),t.instance=this}connect(){this.socket=io(this.url,{path:"/sio/socket.io/",transports:["websocket"],reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:2e3,reconnectionDelayMax:2e7,timeout:2e4}),this.setupConnectionEvents()}ensureConnected(){this.socket.connected||(this.socket.connect(),this.eventListenersAdded||this.setupConnectionEvents())}isConnected(){return this.socket.connected}sendMessage(e){this.socket.connected&&this.socket.emit("message",e)}sendEmit(e,t){this.socket.connected&&this.socket.emit(e,t)}shutDown(){this.socket.disconnect(),this.currentAlertId=null,ie(null),overrideNovaAgentMode=!1,browserSocketStarted=!1}createChannel(e){this.subscribedChannels.add(e),this.sendEmit("listen_for_task",{channel_id:e})}sendPing(e,t){this.subscribedChannels.add(e),this.socket.connected&&this.socket.emit("trigger_listener",{channel_id:e,message:t})}setupConnectionEvents(){this.eventListenersAdded||(this.socket.on("connect",(()=>{this.resubscribeChannels(),A()&&k(senderAI,"Connected to browsergpt server",!1)})),this.socket.on("reconnect",(()=>{this.socket.connected&&this.resubscribeChannels()})),this.socket.on("disconnect",(e=>{(b()||novaAgentMode)&&(D(!1),browserSocketStarted=!1,bgptExecutorIsOnline=!1),A()&&k(senderAI,"Disconnected from browsergpt server",!1)})),this.socket.on("connect_error",(e=>{(b()||novaAgentMode)&&(D(!1),bgptExecutorIsOnline=!1),A()&&k(senderAI,"Disconnected from browsergpt server due to connection error",!1)})),this.socket.on("reconnect_attempt",(e=>{})),this.socket.on("reconnect_failed",(()=>{})),this.socket.on("i_am_free",(e=>{bgptExecutorIsOnline||(bgptExecutorIsOnline=!0,A()?k(senderAI,"BrowserGPT Desktop Agent is online and listening",!1):b()||(k(senderAI,"BrowserGPT Remote Agent is online and listening for remote requests...",!1),window.sendUpdateSuggestions&&window.sendUpdateSuggestions([{instruction:"BrowserGPT Agent is ready for instructions",action:"do_nothing"},{instruction:"Ask me to perform a task",action:"do_nothing"}])))})),this.socket.on("broadcast",(e=>{if("voice_button_state"===e.message.key){const t=e.message.value;(t.triggeredFromTab||"idle"===t.state||b()&&!isStreaming)&&R(t)}else if("current_url"===e.message.key){const t=e.message.value,n=e=>{try{return new URL(e).hostname}catch(t){return e}},o=n(currentUrl),i=n(t);o!==i?(currentUrl=t,"browser.civai.co"!==i&&"browsergpt.co"!==i?(k(senderUser,`just navigated to ${i}.`,!1),ve(`Silent notification: user just navigated to ${i}. Use this information to make informed suggestions and actions`,"system")):ve("Silent notification: user just navigated back to BrowserGPT dashboard. Use this information to make informed suggestions and actions. Do not say anything about this particular navigation","system")):currentUrl=t}else if("captureScreen"===e.message.key)currentTabImage=e.message.value,ve(`${e.message.value}\n\nCurrent page url: ${currentUrl}`,"system",!0);else if("cancel_mode"===e.message.key)e.message.value?(he(!1),F(!0)):F(!1);else if("spinner_mode"===e.message.key)e.message.value?(F(!1),he(!0)):he(!1);else if("updateSuggestions"===e.message.key&&A()){k(senderAI,"BrowserGPT recieved new suggestions...",!1);const t=e.message.value;Array.isArray(t)&&t.forEach((e=>{k(senderAI,e,!1)}))}})),this.socket.on("i_am_busy",(e=>{A()&&!b()&&(bgptExecutorIsOnline=!1)})),this.socket.on("set_current_task",(e=>{ie(e,!0)})),this.socket.on("instruction_request",(e=>{e.current_url=window.location.href,z((t=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"instructionRequestReceived",instruction:e,apikey:t,bgptIndex:v(),currentStateId:setCurrentStateId},"*")})),(novaAgentMode||overrideNovaAgentMode)&&this.handleInstruction(e)})),this.socket.on("are_you_free",(e=>{A()||se().then((t=>{null==t?z((t=>{this.sendEmit("bgpt_notifications",{event:"i_am_free",message:e,channel_id:t}),window.sendUpdateSuggestions&&window.sendUpdateSuggestions([{instruction:"BrowserGPT Agent is ready for instructions",action:"do_nothing"},{instruction:"Ask me to perform a task",action:"do_nothing"}])})):(z((t=>{this.sendEmit("bgpt_notifications",{event:"i_am_busy",message:e,channel_id:t})})),window.sendUpdateSuggestions&&window.sendUpdateSuggestions([{instruction:"BrowserGPT Agent is busy, please wait...",action:"do_nothing"}]))}))})),this.socket.on("mobile_message",(e=>{if(A()&&!b()){const t=e.message,n=[(e,n)=>{He(t.text,(()=>{e()}))}];Se("info_message",t.text,instructionId),t.is_question?n.push(((e,n)=>{Ye(t.text).then((n=>{let o={id:t.id,answer:n?"yes":"no"};z((e=>{this.sendEmit("bgpt_notifications",{event:"mobile_message_answer",message:o,channel_id:e})})),e()})).catch((n=>{let o={id:t.id,answer:"no"};z((e=>{this.sendEmit("bgpt_notifications",{event:"mobile_message_answer",message:o,channel_id:e})})),e()}))})):t.is_chat?n.push(((e,n)=>{!function(e){ne([(t,n)=>{k(senderAI,e),t()},(e,t)=>{e()}]).then((()=>{})).catch((e=>{}))}(t.text),e()})):n.push(((e,n)=>{Xe(t.text,(t=>{e()}))})),ne(n).then((()=>{})).catch((e=>{}))}})),this.socket.on("message_answer",(t=>{if(!A()){const{id:n,answer:o}=t;if(this.isCurrentAlertId(n)){const t=e?.querySelector("#ok-button"),n=e?.querySelector("#cancel-button");"yes"===o&&t?t.click():"no"===o&&n&&n.click()}}})),this.socket.on("message",(e=>{const t=e;"instructions_list"===t.command?this.handleInstructionList(t.message):"new_alert"===t.command&&"Your license key is invalid or expired"===t.message&&this.shutDown()})),this.eventListenersAdded=!0)}resubscribeChannels(){this.subscribedChannels.forEach((e=>{overrideNovaAgentMode||v()&&novaAgentMode?this.createChannel(e):A()&&this.sendPing(e,"resubscribe")}))}setCurrentAlertId(e){this.currentAlertId=e}getCurrentAlertId(){return this.currentAlertId}isCurrentAlertId(e){return this.currentAlertId===e}handleInstructionList(e){const t=e.map((e=>({id:e.id,title:e.text,status:e.status,execution_date:e.execution_date})));v()&&renderTasks(t)}handleInstruction(e){const t=e.text;if(t&&"smartsense"===t.trim().toLowerCase()&&!A())return window.sendUpdateSuggestions&&window.sendUpdateSuggestions([{instruction:"SmartSense triggered from mobile",action:"do_nothing"}]),void window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"generateSuggestions",currentStateId:setCurrentStateId,showLoading:!0,bgptIndex:v(),extraInstructions:""},"*");se().then((n=>{(null==n&&1==overrideNovaAgentMode&&e.connection_id===nt&&instructionId!==e.id||null==n&&novaAgentMode&&v()&&e.connection_id===nt)&&(z((e=>{this.sendEmit("bgpt_notifications",{event:"set_current_task",message:t,channel_id:e})})),D(!1),He("Received new remote instruction, processing...",(()=>{window.sendUpdateSuggestions&&window.sendUpdateSuggestions([{instruction:`Processing: "${t}"`,action:"do_nothing"},{instruction:"Working on your request...",action:"do_nothing"}],!0),ve(`Received the following instruction from mobile: ${t}\n\nthis request will be processed in the background, you will received progress reports`,"system"),instructionId=e.id+"_from_mobile",k(senderUser,t),I().then((o=>{z((i=>{fetch("https://api.browser.civai.co/text_prompt",{method:"POST",headers:{"Content-Type":"application/json","Bgpt-License-Key":i},body:JSON.stringify({instruction:t,conv_history:o})}).then((e=>{if(403===e.status){const e=new Error("Access forbidden: Invalid license key or insufficient permissions.");throw e.status=403,e}return e.json()})).then((t=>{t.instructionId=e.id,ee(t);["converse","switch_to_tab","schedule_task","cancel_ongoing_process","update_ask_permissions"].includes(t.action)&&setTimeout((()=>{it(n).then((()=>{lt()})).catch((e=>{}))}),15e3)})).catch((e=>{Oe(e)}))}))})).catch((e=>{Xe("Error getting chat history, cant process instruction")}))})))}))}invokeExtension(e,t){firstTaskInit=!0,z((n=>{window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"novaOpenWeb",prompt:e,url:t,apikey:n,bgptIndex:v(),novaUrl,currentStateId:setCurrentStateId},"*")}))}closeConnection(){this.socket.disconnect()}},window.broadCastData=rt,window.getWebSocketClientInstance=pt;let mt=e?.querySelector("#bubble"),wt=2,gt=2.6;function yt(){return mt.scrollHeight>mt.clientHeight||mt.scrollWidth>mt.clientWidth}function ht(){if(function(){let e=mt.textContent.trim().split(/\s+/);e.length>19&&(mt.textContent=e.slice(0,20).join(" ")+"...")}(),gt<wt&&!yt())gt+=.2,mt.style.fontSize=`${gt}vh`,requestAnimationFrame(ht);else if(yt())do{gt=Math.max(1.8,gt-.2),mt.style.fontSize=`${gt}vh`}while(yt()&&gt>1.8)}async function ft(t,n){if(t)try{_t(t,!0),await n(),await new Promise((t=>{const n=e?.querySelector("#modal"),o=e?.querySelector("#support-form-modal"),i=setInterval((()=>{(n&&!n.classList.contains("hidden")||o&&!o.classList.contains("hidden"))&&(clearInterval(i),clearTimeout(s),t())}),100),s=setTimeout((()=>{clearInterval(i),t()}),5e3)}))}finally{_t(t,!1)}}async function bt(t){async function n(){kt('<div class="modal-loading-spinner"></div>');try{const t=await fetch("https://gist.githubusercontent.com/mrkeyiano/c3da60027163581b5727f0af75aadd95/raw"),n=await t.json();let o='<h2 class="modal-title">Frequently Asked Questions</h2>';o+='<div class="modal-scroll-content"><div class="two-column-grid">',n.faqs.forEach((e=>{o+=`\n\t\t\t\t\t<div class="faq-item">\n\t\t\t\t\t\t<div class="faq-question">\n\t\t\t\t\t\t\t${e.question}\n\t\t\t\t\t\t\t<i class="fas fa-chevron-down"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="faq-answer">\n\t\t\t\t\t\t\t${e.answer}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`})),o+="</div></div>",kt(o),e?.querySelectorAll(".faq-item").forEach((t=>{t.addEventListener("click",(()=>{e?.querySelectorAll(".faq-item").forEach((e=>{e!==t&&e.classList.contains("active")&&e.classList.remove("active")})),t.classList.toggle("active")}))}))}catch(e){kt('<h2 class="modal-title">Error</h2><p>Failed to load FAQ data. Please try again later.</p>')}}t?await ft(t,(async()=>{await n()})):await n()}async function vt(e){async function t(){kt('<div class="modal-loading-spinner"></div>');try{const e=await fetch("https://gist.githubusercontent.com/mrkeyiano/c3da60027163581b5727f0af75aadd95/raw"),t=await e.json();let n='<h2 class="modal-title">Key Features</h2>';n+='<div class="modal-scroll-content"><div class="feature-grid">',t.features.forEach((e=>{n+=`\n\t\t\t\t\t<div class="feature-item">\n\t\t\t\t\t\t<div class="feature-name">${e.name}</div>\n\t\t\t\t\t\t<div class="feature-description">${e.description}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`})),n+="</div></div>",kt(n)}catch(e){kt('<h2 class="modal-title">Error</h2><p>Failed to load features data. Please try again later.</p>')}}e?await ft(e,(async()=>{await t()})):await t()}async function St(t){const n=e?.querySelector("#support-form-modal");n&&n.classList.remove("hidden")}function kt(t,n=!0){const o=e?.querySelector("#modal"),i=o.querySelector(".modal-content"),s=e?.querySelector("#modal-text"),r=e?.querySelector("#ok-button"),a=e?.querySelector("#cancel-button"),c=e?.querySelector("#modal-input-container"),l=(e?.querySelector("#modal-input"),e?.querySelector("#close-modal"));c&&c?.classList&&c.classList.add("hidden"),a&&a.classList.add("hidden"),o&&i&&i.classList.add("expanded"),o&&s&&s.classList.add("expanded"),l&&l.classList.contains("hidden")&&l.classList.remove("hidden"),o&&s&&(s.innerHTML=t),o&&o.classList.remove("hidden"),r&&n?(r.classList.remove("hidden"),r.textContent="OK"):r.classList.add("hidden");let d=r.addEventListener("click",(()=>{It(),r.removeEventListener("click",d)}))}function It(){const t=e?.querySelector("#modal");t&&et(t),Tt()}function Tt(){const t=e?.querySelector("#modal");if(!t)return;const n=t.querySelector(".modal-content"),o=e?.querySelector("#modal-text");t&&n&&n.classList.remove("expanded"),t&&o&&o.classList.remove("expanded"),et(t,!0)}function Et(t="toggle"){const n=e?.querySelector(".help-topics"),o=e?.querySelector(".help-backdrop");n&&o&&("on"===t?(n.classList.add("show"),o.classList.add("show")):"off"===t?(n.classList.remove("show"),o.classList.remove("show")):(n.classList.toggle("show"),o.classList.toggle("show")))}function Ct(){Et("toggle")}function _t(e,t){if(e)if(t){e.classList.add("topic-loading"),e.dataset.originalContent=e.innerHTML;const t=e.querySelector("span")?.textContent||"";e.innerHTML=`\n\t\t\t<i class="fas fa-spinner fa-spin"></i>\n\t\t\t<span>${t}</span>\n\t\t`}else e.dataset.originalContent&&(e.innerHTML=e.dataset.originalContent),e.classList.remove("topic-loading")}mt&&requestAnimationFrame(ht),(()=>{let t,n=!1,o=null,i=!1,s=0,r=null;let a=!1;setTimeout((function n(){if("loading"!==e.readyState){if(window.PipController)try{t=new window.PipController({pipTitle:"BrowserGPT SmartSense (Stealth mode)",pipHeader:'\n\t\t\t\t\t<div style="display: flex; align-items: center; gap: 10px; width: 100%; justify-content: center;">\n\t\t\t\t\t\t\x3c!-- <i class="fas fa-eye-slash"></i> --\x3e\n\t\t\t\t\t\t<span>BrowserGPT SmartSense</span>\n\t\t\t\t\t</div>\n\t\t\t\t',pipHeaderStyle:{backgroundColor:"#15191E",color:"#04A492",padding:"10px",borderBottom:"1px solid rgba(4, 164, 146, 0.2)"},enableExtensionSuggestions:!0,customSuggestions:[{action:"scroll_down",text:"Scroll down to the bottom of the current page"},{action:"scroll_up",text:"Scroll up to the top of the current page"},{action:"close_stealth_mode",text:"Close SmartSense in Stealth Mode"}]}),window.pipController=t}catch(e){}}else e.addEventListener("DOMContentLoaded",(()=>setTimeout(n,100)))}),500);let c,l,d=!1,u=null;const p=e.querySelector(".sticky-button.top"),m=e.querySelector(".sticky-button.bottom"),w=e.querySelector(".sticky-button:not(.top):not(.bottom)"),g=e.querySelector(".sticky-button-container");function y(e=!0){const t=b.querySelector("style");if(e&&!t){const e=document.createElement("style");e.textContent="\n\t\t\t:host #sticky-chat-button:hover + .suggestions-list,\n\t\t\t:host .suggestions-list:hover {\n\t\t\t\topacity: 1 !important;\n\t\t\t\tvisibility: visible !important;\n\t\t\t\ttransform: translateX(0) !important;\n\t\t\t}\n\t\t",b.appendChild(e)}else!e&&t&&t.remove()}function h(t){d=!1;e.querySelector(".kebab-handle").style.cursor="grab"}let f=[{text:"Scroll down to the bottom of the current page",icon:"arrow-down",action:"scroll_down"},{text:"Scroll up to the top of the current page",icon:"arrow-up",action:"scroll_top"},{text:"Open SmartSense in Stealth Mode",icon:"eye",action:"open_stealth_mode"},{text:"Close Sticky",icon:"times",action:"close_sticky_mode"}],b=null;function v(){const e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight),t=window.innerHeight,n=document.querySelector('[class*="scroll"], [class*="overflow"], [class*="main"]');return n?n.scrollHeight>n.clientHeight:e>t}function S(e){setTimeout((()=>{e.relatedTarget?.closest("#sticky-chat-button")||this.classList.remove("show")}),2e3),N(g,"both")}function I(e,t=!1){if(!b)return;if(!t){const t=e.querySelector(".suggestions-list");let n=0,i=0;document.addEventListener("mousemove",(e=>{n=e.clientX,i=e.clientY}));const s=e=>{if(!e)return!1;const t=e.getBoundingClientRect();return n>=t.left&&n<=t.right&&i>=t.top&&i<=t.bottom};t&&(y(!0),t?.classList.add("show"),o=setTimeout((()=>{const n=e.querySelector(".sticky-button-container");s(t)||s(n)||b?.classList.remove("show")}),7e3))}m.addEventListener("mouseenter",(()=>{m.querySelector(".chat-icon").classList.contains("hidden")&&(y(!0),b?.classList.add("show"),x())})),m.addEventListener("mouseleave",(e=>{e.relatedTarget?.closest(".suggestions-list")||setTimeout((()=>{b?.classList.remove("show")}),2e3)})),p.addEventListener("mouseenter",(()=>{b?.classList.remove("show")})),w.addEventListener("mouseenter",(()=>{b?.classList.remove("show")}));e.querySelector(".sticky-button-container").addEventListener("mouseleave",(()=>{setTimeout((()=>{b?.classList.remove("show")}),2e3)})),b.addEventListener("mouseenter",(()=>{o&&(clearTimeout(o),o=null)})),b.addEventListener("mouseleave",S),window.addEventListener("resize",x)}async function T(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>")}function E(t){const n=document.createElement("div");return n.className="suggestions-list",t.forEach((t=>{const o=document.createElement("div");o.className="suggestion-item";const i=document.createElement("i");i.className=`fas fa-${t.icon}`;const s=document.createElement("span");if("do_nothing"===t.action){o.title="Click to copy to clipboard",o.classList.add("copyable");const t=document.createElement("i");if(t.className="fas fa-copy copy-indicator",t.style.cssText="\n\t\t\t\tfont-size: 10px;\n\t\t\t\tmargin-left: 5px;\n\t\t\t\tcolor: rgba(255,255,255,0.6);\n\t\t\t",!e.querySelector("#copyable-style")){const t=document.createElement("style");t.id="copyable-style",t.textContent="\n\t\t\t\t\t.suggestion-item.copyable {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t}\n\t\t\t\t\t.suggestion-item.copyable:hover {\n\t\t\t\t\t\tbackground-color: rgba(4, 164, 146, 0.1);\n\t\t\t\t\t}\n\t\t\t\t\t.suggestion-item .copy-indicator {\n\t\t\t\t\t\topacity: 0.6;\n\t\t\t\t\t\ttransition: opacity 0.2s ease;\n\t\t\t\t\t}\n\t\t\t\t\t.suggestion-item.copyable:hover .copy-indicator {\n\t\t\t\t\t\topacity: 1;\n\t\t\t\t\t}\n\t\t\t\t",e.appendChild(t)}}(async function(e){try{if(window.bgptMarked){if("function"==typeof window.bgptMarked)return window.bgptMarked(e);if("function"==typeof window.bgptMarked.parse)return window.bgptMarked.parse(e)}return T(e)}catch(t){return T(e)}})(t.text).then((e=>{if(s.innerHTML=e,o.appendChild(i),o.appendChild(s),"do_nothing"===t.action){const e=document.createElement("i");e.className="fas fa-copy copy-indicator",e.style.cssText="\n\t\t\t\t\tfont-size: 10px;\n\t\t\t\t\tmargin-left: 5px;\n\t\t\t\t\tcolor: rgba(255,255,255,0.6);\n\t\t\t\t",o.appendChild(e)}o.addEventListener("click",(()=>{!function(e,t){switch(e){case"scroll_next":window.scrollBy({top:window.innerHeight,behavior:"smooth"});break;case"scroll_top":case"scroll_up":const e=document.querySelector('[class*="scroll"], [class*="overflow"], [class*="main"]')||document.documentElement;e!==document.documentElement&&e.scrollTo({top:0,behavior:"smooth"}),window.scrollTo({top:0,behavior:"smooth"});break;case"scroll_down":const n=document.querySelector('[class*="scroll"], [class*="overflow"], [class*="main"]')||document.documentElement;n!==document.documentElement&&n.scrollTo({top:Math.max(n.scrollHeight,n.offsetHeight),behavior:"smooth"}),window.scrollTo({top:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight),behavior:"smooth"});break;case"trigger_license_prompt":M(!0,m),setTimeout((()=>{M(!1,m)}),4e3),P(!0);break;case"do_nothing":navigator.clipboard.writeText(t).then((()=>{B("Copied to clipboard","success")})).catch((e=>{B("Failed to copy to clipboard","error")}));break;case"open_stealth_mode":q(!0);break;case"close_sticky_mode":a=!0,q(!0,"sticky");break;case"ask_clarifying_questions":M(!0,m),N(g,"both"),A(g,"bottom"),window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"generateSuggestions",currentStateId:setCurrentStateId,showLoading:!0,bgptIndex:!1,extraInstructions:t});break;default:F(!0),window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"captureTab",prompt:t,data:null,apikey:z(),bgptIndex:!1,novaUrl:"",currentStateId:setCurrentStateId,instructionId:Date.now(),enforceUserConfirmation:!1,enable_realtime_mode:!1,directExecution:!1,stepsLimit:10,maxAttempts:3},"*")}}(t.action,t.text),y(!1),"do_nothing"!==t.action&&n.classList.remove("show")})),n.appendChild(o)}))})),n.addEventListener("mouseleave",S),n}function C(e=null){let t=m.querySelector(".chat-icon");e||(e=t&&!t.classList.contains("hidden")?"Hover for 3s to see suggestions":"Hover for 3s to see chat"),document.documentElement.style.setProperty("--chat-button-tooltip",`"${e}"`),m&&m.classList.add("show-tooltip")}function _(){m&&m.classList.remove("show-tooltip")}function L(e){_(),setTimeout((()=>{C(e)}),100)}function x(){if(!b||!m)return;const e=m.getBoundingClientRect(),t=window.innerHeight;b.style.bottom="",b.style.top="",b.style.visibility="hidden",b.style.display="block";const n=b.scrollHeight;b.style.display="",b.style.visibility="";const o=t-e.bottom,i=e.top;o<n&&i>o?(b.style.bottom=`${e.height+10}px`,b.style.top="auto"):(b.style.top=`${e.height+10}px`,b.style.bottom="auto");const s=Math.min(300,Math.max(o,i)-20);b.style.maxHeight=`${s}px`}function q(o,i="normal"){if(!t)return;const s=e.querySelector(".sticky-button-container");o?(n=!0,s&&(s.style.display="none"),"normal"===i&&t.openPip()):(n=!1,s&&(s.style.display=""),t.closePip())}!function(){if(e.querySelector("#suggestions-list-style"))return;const t=document.createElement("style");t.id="suggestions-list-style",t.textContent="\n\t\t.suggestions-list {\n\t\t\tmax-height: 300px;\n\t\t\toverflow-y: auto;\n\t\t\tscrollbar-width: none; /* Firefox */\n\t\t\t-ms-overflow-style: none; /* IE and Edge */\n\t\t}\n\t\t.suggestions-list::-webkit-scrollbar {\n\t\t\tdisplay: none; /* Chrome, Safari, Opera */\n\t\t}\n\t",e.appendChild(t)}();const A=(t=g,n="both")=>{if(t)if(void 0!==e&&e){const t=e.querySelectorAll(".sticky-button.top"),o=e.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||t.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"}))}else{const e=t.querySelectorAll(".sticky-button.top"),o=t.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||e.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="1",e.style.visibility="visible",e.style.transform="translateY(0)"}))}},N=(t,n="both")=>{if(t)if(void 0!==e&&e){const t=e.querySelectorAll(".sticky-button.top"),o=e.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||t.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""}))}else{const e=t.querySelectorAll(".sticky-button.top"),o=t.querySelectorAll(".sticky-button.bottom");"top"!==n&&"both"!==n||e.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""})),"bottom"!==n&&"both"!==n||o.forEach((e=>{e.style.opacity="",e.style.visibility="",e.style.transform=""}))}};function B(t,n="success"){if(!b)return;let o=e.querySelector(".suggestions-notification-container");o||(o=document.createElement("div"),o.className="suggestions-notification-container",o.style.cssText="\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\tpointer-events: none;\n\t\t\tz-index: 1000;\n\t\t",b.appendChild(o));const i=document.createElement("div");i.className=`suggestions-notification suggestions-notification-${n}`,i.textContent=t,i.style.cssText=`\n\t\tpadding: 8px 16px;\n\t\tborder-radius: 4px;\n\t\tmargin: 8px;\n\t\tfont-size: 14px;\n\t\tfont-weight: 500;\n\t\tbox-shadow: 0 2px 4px rgba(0,0,0,0.2);\n\t\topacity: 0;\n\t\ttransition: opacity 0.3s ease-in-out;\n\t\tcolor: white;\n\t\tbackground-color: ${"error"===n?"#f44336":"#04A492"};\n\t\tpointer-events: none;\n\t\ttext-align: center;\n\t\tmax-width: 90%;\n\t`,o.appendChild(i),setTimeout((()=>{i.style.opacity="1"}),10),setTimeout((()=>{i.style.opacity="0",setTimeout((()=>{i&&i.parentNode&&i.parentNode.removeChild(i),o&&0===o.children.length&&o.parentNode.removeChild(o)}),300)}),2e3)}function M(e,t=null){i=e,e?(s=Date.now(),r&&(clearTimeout(r),r=null),r=setTimeout((()=>{const e=Date.now();i&&e-s>=59e3&&M(!1,t)}),6e4)):r&&(clearTimeout(r),r=null),he(e,t)}!function(){const t=e.querySelector(".kebab-handle");t.addEventListener("mousedown",(function(t){d=!0,this.style.cursor="grabbing",function(t){d=!0;const n=e.querySelector(".sticky-button-container");c=t.clientY,l=parseInt(getComputedStyle(n).top)}(t)})),t.addEventListener("mouseup",(function(e){d=!1,this.style.cursor="grab",h()})),window.addEventListener("mousemove",(function(t){if(d){const n=e.querySelector(".sticky-button-container"),o=t.clientY-c;n.style.top=`${l+o}px`}})),window.addEventListener("pointermove",(function(t){if(d){const n=e.querySelector(".sticky-button-container"),o=t.clientY-c;n.style.top=`${l+o}px`}})),window.addEventListener("mouseup",h),window.addEventListener("pointerup",h),globalButton=w,w.addEventListener("mousedown",(function(e){e.target.closest(".kebab-handle")||this.classList.add("active")})),w.addEventListener("mouseup",(function(e){this.classList.remove("active")})),w.addEventListener("mouseleave",(function(e){this.classList.remove("active")})),m.addEventListener("mousedown",(function(t){if(t.preventDefault(),!t.target.closest(".kebab-handle")){const t=m.querySelector(".chat-icon");if(t&&!t.classList.contains("hidden"))window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"handleChatButtonClick",currentStateId:setCurrentStateId,bgptIndex:!1},"*"),M(!0,m);else{M(!0,m),N(g,"both"),A(g,"bottom"),window.postMessage({type:"BGPT_INVOKE_EXTENSION",action:"generateSuggestions",currentStateId:setCurrentStateId,showLoading:!0,bgptIndex:!1,extraInstructions:""},"*");const t=e.querySelector(".suggestions-list");t&&t.classList.add("loading")}}const n=document.getElementById("modal");if(n){const e=n.querySelector(".modal-content");n.addEventListener("click",(function(t){e.contains(t.target)||n.classList.add("hidden")}))}})),p.addEventListener("mousedown",(function(e){if(e.preventDefault(),e.target.closest(".kebab-handle"))return;St();const t=o.querySelector(".modal-content");o.addEventListener("click",(function(e){t.contains(e.target)||o&&o.classList&&!o.classList.contains("hidden")&&o.classList.add("hidden")}))}));const o=e.querySelector("#support-form-modal");if(o){const t=o.querySelector(".modal-close-button"),n=o.querySelector("#help-form");t&&t.addEventListener("click",(function(e){e.preventDefault(),o.classList.add("hidden")})),n&&n.addEventListener("submit",(async function(t){!async function(t){t.preventDefault();const n=t.target,o=new FormData(n);try{if(!(await fetch("https://formspree.io/f/xbldkqzd",{method:"POST",body:o,headers:{Accept:"application/json"}})).ok)throw new Error("Failed to send message");{const t=e?.querySelector("#support-form-modal");t&&et(t),Xe("Support request sent successfully, we will get back to you soon."),n.reset()}}catch(t){const n=e?.querySelector("#support-form-modal");n&&et(n),Xe("Failed to send message. Please try again.")}}(t)}))}const i=document.getElementById("modal"),s=document.getElementById("close-modal");s&&i&&s.addEventListener("click",(function(e){e.preventDefault(),i.classList.add("hidden")})),function(e){if(a)return;const t=m.querySelector(".chat-icon"),o=m.querySelector(".lightbulb-icon");let i=v()?f:f.filter((e=>!["scroll_down","scroll_top"].includes(e.action)));i.length>0?(t.classList.add("hidden"),o.classList.remove("hidden"),b=E(i),g.appendChild(b),I(e,dontPopOut=!0)):(t.classList.remove("hidden"),o.classList.add("hidden"),b=null);window.addEventListener("message",(function(i){if(i.data&&"PIP_CLOSED"===i.data.type&&"show_sticky_container"===i.data.action){n=!1;const t=e.querySelector(".sticky-button-container");t&&(t.style.display="")}else if(i.source===window&&"BGPT_FROM_EXTENSION"===i.data.type&&"updateSuggestions"===i.data.content.action){if(M(!1,m),N(g,"both"),b&&b.classList.remove("loading"),"smartSenseDisabled"===i.data.content.message)return void Xe("BrowserGPT SmartSense is disabled. Please enable it via Voice Prompt.");if("loading"===i.data.content.message)return M(!0,m),void b.classList.add("loading");if("error"===i.data.content.message||"error403"===i.data.content.message){let e={text:"error403"===i.data.content.message?"Your license key is invalid or expired. Please click here to update your license key to continue using BrowserGPT":"Error generating suggestions. Please try again later.",icon:"exclamation-triangle",action:"do_nothing"};n&&a||("error403"===i.data.content.message?Xe("Your license key is invalid or expired. Please click here to update your license key to continue using BrowserGPT",(()=>{P(!0)})):Xe("Error generating suggestions. Please try again later.")),Array.isArray(i.data.content.message)||(i.data.content.message=[]),i.data.content.message.push(e)}if("no_suggestions"===i.data.content.message){let e={text:"No suggestions available. Please try again later.",icon:"exclamation-triangle",action:"do_nothing"};n||a||Xe("No suggestions available. Please try again later."),Array.isArray(i.data.content.message)||(i.data.content.message=[]),i.data.content.message.push(e)}const s=e.querySelector(".suggestions-list");if(s&&s.classList.remove("loading"),M(!1,m),!i.data.content.message)return;if(!Array.isArray(i.data.content.message))return;let r=v()?i.data.content.message:i.data.content.message.filter((e=>!["scroll_down","scroll_top"].includes(e.action)));{const e=r.map((e=>e.text));if(k(senderAI,"Sending new suggestions to mobile...",!1),rt("updateSuggestions",e),a)return}if(r.push({text:"Open SmartSense in Stealth Mode",icon:"eye",action:"open_stealth_mode"}),r.push({text:"Close Sticky",icon:"times",action:"close_sticky_mode"}),r&&r.length>0){t.classList.add("hidden"),o.classList.remove("hidden"),b&&b.removeEventListener("mouseleave",S);const n=E(r);b&&b.parentNode?g.replaceChild(n,b):g.appendChild(n),b=n,I(e)}else t.classList.remove("hidden"),o.classList.add("hidden"),b&&b.parentNode&&b.remove(),b=null}}))}(e)}(),function(){if(!m)return;let e=!1;m.addEventListener("mouseenter",(function(){e=!0,C(),u&&clearTimeout(u),u=setTimeout((function(){if(e){_();const e=m.querySelector(".chat-icon"),t=m.querySelector(".lightbulb-icon");e&&!e.classList.contains("hidden")?(e.classList.add("hidden"),t.classList.remove("hidden"),L("Click to fetch suggestions"),b&&b.classList.add("show")):t&&!t.classList.contains("hidden")&&(t.classList.add("hidden"),e.classList.remove("hidden"),L("Hover for 3s to see suggestions"))}}),3e3)})),m.addEventListener("mouseleave",(function(){e=!1,_(),u&&(clearTimeout(u),u=null)}))}(),window.openSticky=function(){a=!1}})(),window.showFAQ=bt,window.showFeatures=vt,window.showSupportForm=St,window.closeCustomModal=It,document.addEventListener("click",(t=>{const n=e?.querySelector("#support-form-modal"),o=t.target.closest(".help-topic");if(n&&!o&&!n.classList.contains("hidden")&&v()&&!b()){const e=n.querySelector(".modal-content");e&&!e.contains(t.target)&&n.classList.add("hidden")}})),document.addEventListener("keydown",(t=>{if("Escape"===t.key){const t=e?.querySelector(".help-topics"),n=e?.querySelector(".help-backdrop"),o=e?.querySelector("#support-form-modal");t&&t.classList.remove("show"),n&&n.classList.remove("show"),o&&et(o)}}));const Lt=e?.querySelector("#close-modal");Lt&&Lt.addEventListener("click",(()=>{Tt()})),f&&f.addEventListener("click",(()=>{Tt()}));const xt=e?.querySelector("#modal");async function Pt(t){async function n(){z((t=>{J(t,(n=>{let o=!t||"undefined"===t||!1===t,i=t&&"undefined"!==t&&!t.endsWith("@browsergpt.co")&&n,s=t&&t.endsWith("@civai.co")&&n;const r=`\n\t\t\t\t\t<h2 class="modal-title">Choose Your Subscription Plan</h2>\n\t\t\t\t\t<div class="subscription-container">\n\t\t\t\t\t\t<div class="subscription-box free-tier ${o?"active-plan":""}">\n\t\t\t\t\t\t\t<h3>Free Tier</h3>\n\t\t\t\t\t\t\t<div class="price">$0</div>\n\t\t\t\t\t\t\t<ul class="features-list">\n\t\t\t\t\t\t\t\t<li>Basic voice commands</li>\n\t\t\t\t\t\t\t\t<li>Limited monthly usage</li>\n\t\t\t\t\t\t\t\t<li>Standard response time</li>\n\t\t\t\t\t\t\t\t<li>Basic browser automation</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<div class="subscription-footer">\n\t\t\t\t\t\t\t\t<a class="subscription-button disabled" href="javascript:void(0)" tabindex="-1">${o?"Current Plan":"Basic Plan"}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="subscription-box monthly-tier ${i?"active-plan":s?"":"highlighted"}">\n\t\t\t\t\t\t\t<div class="popular-badge">Most Popular</div>\n\t\t\t\t\t\t\t<h3>Monthly Subscription</h3>\n\t\t\t\t\t\t\t<div class="price">$9.99<span>/month</span></div>\n\t\t\t\t\t\t\t<ul class="features-list">\n\t\t\t\t\t\t\t\t<li>Unlimited voice commands</li>\n\t\t\t\t\t\t\t\t<li>Priority response time</li>\n\t\t\t\t\t\t\t\t<li>Advanced browser automation</li>\n\t\t\t\t\t\t\t\t<li>Email & chat support</li>\n\t\t\t\t\t\t\t\t<li>No usage limits</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<div class="subscription-footer">\n\t\t\t\t\t\t\t\t<a class="subscription-button${i?" disabled":""}" id="monthly-sub-btn" href="${i?"javascript:void(0)":window.generalPaymentLink}" ${i?'tabindex="-1"':""}>${i?"Current Plan":"Subscribe Now"}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="subscription-box lifetime-tier ${s?"active-plan":""}">\n\t\t\t\t\t\t\t<h3>Lifetime Access</h3>\n\t\t\t\t\t\t\t<div class="price">$5000<span>/lifetime</span></div>\n\t\t\t\t\t\t\t<ul class="features-list">\n\t\t\t\t\t\t\t\t<li>All monthly features</li>\n\t\t\t\t\t\t\t\t<li>Lifetime updates</li>\n\t\t\t\t\t\t\t\t<li>Priority support</li>\n\t\t\t\t\t\t\t\t<li>Custom integrations</li>\n\t\t\t\t\t\t\t\t<li>Dedicated account manager</li>\n\t\t\t\t\t\t\t\t<li>Early access to new features</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<div class="subscription-footer">\n\t\t\t\t\t\t\t\t<a class="subscription-button${s?" disabled":""}" id="lifetime-sub-btn" href="${s?"javascript:void(0)":window.lifetimeSubscriptionLink}" ${s?'tabindex="-1"':""} target="_blank">${s?"Current Plan":"Get Lifetime Access"}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;if(!e?.querySelector("#subscription-styles")){const e=document.createElement("link");e.id="subscription-styles",e.rel="stylesheet",e.href="subscription.css",document.head.appendChild(e)}kt(r,!1),setTimeout((()=>{const t=e?.querySelector("#monthly-sub-btn");t&&!i&&t.addEventListener("click",(function(e){gtag_report_conversion()}))}),0)}))}))}Et("off"),t?await ft(t,(async()=>{await n()})):await n()}xt&&xt.addEventListener("click",(e=>{"modal"===e.target.id&&Tt()})),document.addEventListener("DOMContentLoaded",(function(){!function(){if(!e?.querySelector("#help-topics-styles")){const e=document.createElement("style");e.id="help-topics-styles",e.textContent="\n\t\t\t.help-topic.topic-loading {\n\t\t\t\tpointer-events: none;\n\t\t\t\topacity: 0.7;\n\t\t\t\tposition: relative;\n\t\t\t}\n\t\t\t.help-topic.topic-loading i.fa-spinner {\n\t\t\t\tmargin-right: 8px;\n\t\t\t\tcolor: #04A492;\n\t\t\t}\n\t\t\t.help-topics.all-disabled .help-topic {\n\t\t\t\tpointer-events: none;\n\t\t\t\topacity: 0.5;\n\t\t\t}\n\t\t",document.head.appendChild(e)}}(),"#help"===window.location.hash&&Ct(),"#download"===window.location.hash&&window.open(window.extensionInstallUrl,"_blank"),"#subscribe"===window.location.hash&&Pt(),"#how-it-works"===window.location.hash&&bt(),"#smartsense"===window.location.hash&&vt(),"#hands-free"===window.location.hash&&vt(),"#productivity"===window.location.hash&&vt(),window.addEventListener("hashchange",(function(){const e=window.location.hash;"#help"===e?Ct():"#download"===e?window.open(window.extensionInstallUrl,"_blank"):"#subscribe"===e?gtag_report_conversion(window.generalPaymentLink):"#how-it-works"===e?bt():"#smartsense"!==e&&"#hands-free"!==e&&"#productivity"!==e||vt()}))})),window.showSubscription=Pt})();